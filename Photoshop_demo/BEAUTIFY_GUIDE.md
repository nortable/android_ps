# ç¾åŒ–åŠŸèƒ½å®ç°æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [è‡ªåŠ¨å¢å¼º](#1-è‡ªåŠ¨å¢å¼º)
3. [é”åŒ–](#2-é”åŒ–)
4. [å»é›¾](#3-å»é›¾)
5. [æš—è§’](#4-æš—è§’)
6. [å…‰æ™•](#5-å…‰æ™•)
7. [æŸ”ç„¦](#6-æŸ”ç„¦)
8. [UIè®¾è®¡](#uiè®¾è®¡)
9. [å®ç°æ¶æ„](#å®ç°æ¶æ„)
10. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)

---

## åŠŸèƒ½æ¦‚è¿°

### ç¾åŒ– vs è°ƒæ•´ vs æ»¤é•œ

| ç±»å‹ | ç‰¹ç‚¹ | ç¤ºä¾‹ |
|------|------|------|
| **è°ƒæ•´** | åŸºç¡€å‚æ•°è°ƒèŠ‚ï¼Œç²¾ç¡®æ§åˆ¶ | äº®åº¦ã€å¯¹æ¯”åº¦ã€é¥±å’Œåº¦ |
| **æ»¤é•œ** | è‰²å½©é£æ ¼è½¬æ¢ï¼Œè‰ºæœ¯æ•ˆæœ | é»‘ç™½ã€æ€€æ—§ã€ç”µå½±æ„Ÿ |
| **ç¾åŒ–** | æ™ºèƒ½ä¼˜åŒ–ï¼Œä¸€é”®å¢å¼º | è‡ªåŠ¨å¢å¼ºã€é”åŒ–ã€å»é›¾ |

### 6ä¸ªæ ¸å¿ƒåŠŸèƒ½

```
ç¾åŒ–é¢æ¿
â”œâ”€â”€ âš¡ è‡ªåŠ¨å¢å¼º - æ™ºèƒ½åˆ†æï¼Œä¸€é”®ä¼˜åŒ–
â”œâ”€â”€ ğŸ” é”åŒ–     - å¢å¼ºç»†èŠ‚å’Œè¾¹ç¼˜
â”œâ”€â”€ ğŸŒ«ï¸ å»é›¾     - æé«˜æ¸…æ™°åº¦å’Œé€šé€æ„Ÿ
â”œâ”€â”€ ğŸ­ æš—è§’     - å››å‘¨å˜æš—ï¼Œçªå‡ºä¸»ä½“
â”œâ”€â”€ âœ¨ å…‰æ™•     - ä¸­å¿ƒå‘å…‰ï¼Œæ¢¦å¹»æ•ˆæœ
â””â”€â”€ ğŸŒ¸ æŸ”ç„¦     - èƒŒæ™¯è™šåŒ–ï¼Œçªå‡ºä¸»ä½“
```

---

## 1. è‡ªåŠ¨å¢å¼º

### ğŸ“– åŠŸèƒ½è¯´æ˜

**ä½œç”¨**ï¼šä¸€é”®æ™ºèƒ½ä¼˜åŒ–å›¾ç‰‡ï¼Œè‡ªåŠ¨è°ƒæ•´äº®åº¦ã€å¯¹æ¯”åº¦ã€é¥±å’Œåº¦ï¼Œè®©ç…§ç‰‡æ›´é€šé€æ˜äº®ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- å…‰çº¿ä¸è¶³çš„ç…§ç‰‡
- å¯¹æ¯”åº¦åä½çš„ç…§ç‰‡
- è‰²å½©ä¸å¤Ÿé²œè‰³çš„ç…§ç‰‡
- ä¸çŸ¥é“å¦‚ä½•è°ƒæ•´çš„æƒ…å†µ

**æ•ˆæœ**ï¼š
- æš—éƒ¨æäº® 5-15%
- é«˜å…‰ä¿ç•™ï¼ˆé¿å…è¿‡æ›ï¼‰
- å¯¹æ¯”åº¦å¢å¼º 10-20%
- é¥±å’Œåº¦æå‡ 5-10%

### ğŸ”¬ ç®—æ³•åŸç†

#### ç›´æ–¹å›¾åˆ†ææ³•

```
1. åˆ†æå›¾ç‰‡ç›´æ–¹å›¾
   â”œâ”€ è®¡ç®—å¹³å‡äº®åº¦
   â”œâ”€ æ£€æµ‹äº®åº¦åˆ†å¸ƒ
   â””â”€ è®¡ç®—å¯¹æ¯”åº¦èŒƒå›´

2. åˆ¶å®šä¼˜åŒ–ç­–ç•¥
   â”œâ”€ è¿‡æš—ï¼šå¢åŠ äº®åº¦ + æå‡é˜´å½±
   â”œâ”€ è¿‡äº®ï¼šé™ä½é«˜å…‰
   â”œâ”€ å¯¹æ¯”åº¦ä½ï¼šæ‹‰ä¼¸ç›´æ–¹å›¾
   â””â”€ é¥±å’Œåº¦ä½ï¼šé€‚å½“å¢å¼º

3. åº”ç”¨è°ƒæ•´
   â””â”€ ä½¿ç”¨ColorMatrixç»„åˆå˜æ¢
```

#### æ ¸å¿ƒç®—æ³•

```java
public class AutoEnhance {
    
    /**
     * åˆ†æå›¾ç‰‡å¹¶è®¡ç®—ä¼˜åŒ–å‚æ•°
     */
    public static EnhanceParams analyzeImage(Bitmap bitmap) {
        int width = bitmap.getWidth();
        int height = bitmap.getHeight();
        int[] pixels = new int[width * height];
        bitmap.getPixels(pixels, 0, width, 0, 0, width, height);
        
        // è®¡ç®—äº®åº¦ç›´æ–¹å›¾
        int[] histogram = new int[256];
        float totalBrightness = 0;
        
        for (int pixel : pixels) {
            int r = (pixel >> 16) & 0xFF;
            int g = (pixel >> 8) & 0xFF;
            int b = pixel & 0xFF;
            
            // è®¡ç®—äº®åº¦ï¼ˆæ„ŸçŸ¥äº®åº¦ï¼‰
            int brightness = (int)(0.299 * r + 0.587 * g + 0.114 * b);
            histogram[brightness]++;
            totalBrightness += brightness;
        }
        
        // è®¡ç®—å¹³å‡äº®åº¦
        float avgBrightness = totalBrightness / pixels.length;
        
        // è®¡ç®—å¯¹æ¯”åº¦ï¼ˆæ ‡å‡†å·®ï¼‰
        float variance = 0;
        for (int pixel : pixels) {
            int r = (pixel >> 16) & 0xFF;
            int g = (pixel >> 8) & 0xFF;
            int b = pixel & 0xFF;
            int brightness = (int)(0.299 * r + 0.587 * g + 0.114 * b);
            variance += Math.pow(brightness - avgBrightness, 2);
        }
        float contrast = (float)Math.sqrt(variance / pixels.length);
        
        // è®¡ç®—é¥±å’Œåº¦
        float totalSaturation = 0;
        for (int pixel : pixels) {
            int r = (pixel >> 16) & 0xFF;
            int g = (pixel >> 8) & 0xFF;
            int b = pixel & 0xFF;
            
            int max = Math.max(r, Math.max(g, b));
            int min = Math.min(r, Math.min(g, b));
            float saturation = max == 0 ? 0 : (float)(max - min) / max;
            totalSaturation += saturation;
        }
        float avgSaturation = totalSaturation / pixels.length;
        
        // åˆ¶å®šä¼˜åŒ–ç­–ç•¥
        EnhanceParams params = new EnhanceParams();
        
        // äº®åº¦è°ƒæ•´ï¼ˆç›®æ ‡ï¼š128é™„è¿‘ï¼‰
        if (avgBrightness < 100) {
            params.brightness = (int)((120 - avgBrightness) * 0.5f);
        } else if (avgBrightness < 120) {
            params.brightness = (int)((128 - avgBrightness) * 0.3f);
        } else if (avgBrightness > 150) {
            params.brightness = (int)((135 - avgBrightness) * 0.2f);
        }
        
        // å¯¹æ¯”åº¦è°ƒæ•´ï¼ˆç›®æ ‡ï¼š50-60ï¼‰
        if (contrast < 40) {
            params.contrast = 1.0f + (45 - contrast) / 100f;
        } else if (contrast < 50) {
            params.contrast = 1.0f + (50 - contrast) / 200f;
        }
        params.contrast = Math.min(1.3f, params.contrast);
        
        // é¥±å’Œåº¦è°ƒæ•´ï¼ˆç›®æ ‡ï¼š0.4-0.5ï¼‰
        if (avgSaturation < 0.35f) {
            params.saturation = 1.0f + (0.45f - avgSaturation) * 0.5f;
        } else if (avgSaturation < 0.4f) {
            params.saturation = 1.0f + (0.45f - avgSaturation) * 0.3f;
        }
        params.saturation = Math.min(1.2f, params.saturation);
        
        return params;
    }
    
    /**
     * åº”ç”¨è‡ªåŠ¨å¢å¼º
     */
    public static Bitmap apply(Bitmap source, float intensity) {
        EnhanceParams params = analyzeImage(source);
        
        // æ ¹æ®å¼ºåº¦è°ƒæ•´å‚æ•°
        int brightness = (int)(params.brightness * intensity);
        float contrast = 1.0f + (params.contrast - 1.0f) * intensity;
        float saturation = 1.0f + (params.saturation - 1.0f) * intensity;
        
        // åº”ç”¨è°ƒæ•´ï¼ˆä½¿ç”¨å·²æœ‰çš„ImageProcessorï¼‰
        return ImageProcessor.adjustAll(source, brightness, contrast, saturation);
    }
    
    static class EnhanceParams {
        int brightness = 0;
        float contrast = 1.0f;
        float saturation = 1.0f;
    }
}
```

### ğŸ’¡ å®ç°è¦ç‚¹

1. **åˆ†æè¦å‡†ç¡®**ï¼šæ­£ç¡®è®¡ç®—å¹³å‡äº®åº¦å’Œå¯¹æ¯”åº¦
2. **è°ƒæ•´è¦é€‚åº¦**ï¼šé¿å…è¿‡åº¦å¢å¼ºï¼ˆå‚æ•°é™åˆ¶åœ¨åˆç†èŒƒå›´ï¼‰
3. **å¼ºåº¦å¯è°ƒ**ï¼šç”¨æˆ·å¯ä»¥æ§åˆ¶å¢å¼ºç¨‹åº¦ï¼ˆ0-100%ï¼‰
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆ†æå¯ä»¥åœ¨åå°çº¿ç¨‹è¿›è¡Œ

### ğŸ¯ å‚æ•°èŒƒå›´

| å‚æ•° | è°ƒæ•´èŒƒå›´ | è¯´æ˜ |
|------|---------|------|
| äº®åº¦ | -20 ~ +20 | æ ¹æ®åŸå›¾äº®åº¦æ™ºèƒ½è°ƒæ•´ |
| å¯¹æ¯”åº¦ | 1.0 ~ 1.3 | é€‚åº¦å¢å¼ºï¼Œé¿å…è¿‡æ› |
| é¥±å’Œåº¦ | 1.0 ~ 1.2 | è½»å¾®æå‡ï¼Œä¿æŒè‡ªç„¶ |

---

## 2. é”åŒ–

### ğŸ“– åŠŸèƒ½è¯´æ˜

**ä½œç”¨**ï¼šå¢å¼ºå›¾ç‰‡ç»†èŠ‚å’Œè¾¹ç¼˜ï¼Œè®©ç…§ç‰‡æ›´æ¸…æ™°ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- è½»å¾®å¤±ç„¦çš„ç…§ç‰‡
- éœ€è¦å¼ºè°ƒç»†èŠ‚çš„ç…§ç‰‡
- æ”¾å¤§åæ˜¾ç¤ºæ¨¡ç³Šçš„ç…§ç‰‡

**æ•ˆæœ**ï¼š
- è¾¹ç¼˜æ›´æ¸…æ™°
- ç»†èŠ‚æ›´çªå‡º
- æ•´ä½“æ›´é”åˆ©

**æ³¨æ„**ï¼šè¿‡åº¦é”åŒ–ä¼šäº§ç”Ÿå…‰æ™•å’Œå™ªç‚¹ã€‚

### ğŸ”¬ ç®—æ³•åŸç†

#### å·ç§¯é”åŒ–æ³•

ä½¿ç”¨å·ç§¯æ ¸ï¼ˆConvolution Kernelï¼‰å¢å¼ºè¾¹ç¼˜ã€‚

```
é”åŒ–æ ¸å¿ƒåŸç†ï¼š
åŸå›¾ - æ¨¡ç³Šå›¾ = è¾¹ç¼˜ä¿¡æ¯
åŸå›¾ + è¾¹ç¼˜ä¿¡æ¯ = é”åŒ–å›¾
```

#### å¸¸ç”¨é”åŒ–æ ¸

```java
// 1. åŸºç¡€é”åŒ–æ ¸ï¼ˆ3x3ï¼‰
float[] sharpenKernel = {
    0, -1,  0,
   -1,  5, -1,
    0, -1,  0
};

// 2. å¼ºé”åŒ–æ ¸
float[] strongSharpenKernel = {
   -1, -1, -1,
   -1,  9, -1,
   -1, -1, -1
};

// 3. é«˜æ–¯é”åŒ–æ ¸ï¼ˆ5x5ï¼Œæ›´å¹³æ»‘ï¼‰
float[] gaussianSharpenKernel = {
   -1, -1, -1, -1, -1,
   -1,  2,  2,  2, -1,
   -1,  2,  8,  2, -1,
   -1,  2,  2,  2, -1,
   -1, -1, -1, -1, -1
};
```

#### å®ç°ä»£ç 

```java
public class SharpenFilter {
    
    /**
     * åº”ç”¨é”åŒ–æ•ˆæœ
     * @param source åŸå§‹å›¾ç‰‡
     * @param intensity å¼ºåº¦ 0.0-1.0
     * @return é”åŒ–åçš„å›¾ç‰‡
     */
    public static Bitmap apply(Bitmap source, float intensity) {
        int width = source.getWidth();
        int height = source.getHeight();
        
        int[] srcPixels = new int[width * height];
        source.getPixels(srcPixels, 0, width, 0, 0, width, height);
        
        int[] dstPixels = new int[width * height];
        
        // æ ¹æ®å¼ºåº¦é€‰æ‹©é”åŒ–æ ¸
        float[] kernel;
        if (intensity < 0.5f) {
            // å¼±é”åŒ–
            kernel = new float[] {
                0, -1,  0,
               -1,  5, -1,
                0, -1,  0
            };
        } else {
            // å¼ºé”åŒ–
            kernel = new float[] {
               -1, -1, -1,
               -1,  9, -1,
               -1, -1, -1
            };
        }
        
        int kernelSize = (int)Math.sqrt(kernel.length);
        int radius = kernelSize / 2;
        
        // å·ç§¯å¤„ç†
        for (int y = 0; y < height; y++) {
            for (int x = 0; x < width; x++) {
                float r = 0, g = 0, b = 0;
                
                // åº”ç”¨å·ç§¯æ ¸
                for (int ky = -radius; ky <= radius; ky++) {
                    for (int kx = -radius; kx <= radius; kx++) {
                        int px = Math.max(0, Math.min(width - 1, x + kx));
                        int py = Math.max(0, Math.min(height - 1, y + ky));
                        
                        int pixel = srcPixels[py * width + px];
                        int kernelIndex = (ky + radius) * kernelSize + (kx + radius);
                        float weight = kernel[kernelIndex];
                        
                        r += ((pixel >> 16) & 0xFF) * weight;
                        g += ((pixel >> 8) & 0xFF) * weight;
                        b += (pixel & 0xFF) * weight;
                    }
                }
                
                // é™åˆ¶èŒƒå›´
                r = Math.max(0, Math.min(255, r));
                g = Math.max(0, Math.min(255, g));
                b = Math.max(0, Math.min(255, b));
                
                int originalPixel = srcPixels[y * width + x];
                int sharpenedPixel = (0xFF << 24) | 
                                    ((int)r << 16) | 
                                    ((int)g << 8) | 
                                    (int)b;
                
                // æ ¹æ®å¼ºåº¦æ··åˆ
                int finalR = (int)(((originalPixel >> 16) & 0xFF) * (1 - intensity) + 
                                  ((sharpenedPixel >> 16) & 0xFF) * intensity);
                int finalG = (int)(((originalPixel >> 8) & 0xFF) * (1 - intensity) + 
                                  ((sharpenedPixel >> 8) & 0xFF) * intensity);
                int finalB = (int)((originalPixel & 0xFF) * (1 - intensity) + 
                                  (sharpenedPixel & 0xFF) * intensity);
                
                dstPixels[y * width + x] = (0xFF << 24) | 
                                          (finalR << 16) | 
                                          (finalG << 8) | 
                                          finalB;
            }
        }
        
        Bitmap result = Bitmap.createBitmap(width, height, source.getConfig());
        result.setPixels(dstPixels, 0, width, 0, 0, width, height);
        return result;
    }
}
```

### ğŸ’¡ å®ç°è¦ç‚¹

1. **è¾¹ç•Œå¤„ç†**ï¼šå·ç§¯æ—¶æ³¨æ„å›¾ç‰‡è¾¹ç¼˜
2. **å¼ºåº¦æ§åˆ¶**ï¼šåŸå›¾å’Œé”åŒ–å›¾æ··åˆ
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨RenderScriptåŠ é€Ÿ
4. **é¿å…è¿‡åº¦**ï¼šå¼ºåº¦ä¸å®œè¶…è¿‡80%

### ğŸ¯ å‚æ•°è¯´æ˜

| å¼ºåº¦ | æ•ˆæœ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| 0-30% | è½»å¾®é”åŒ– | äººåƒï¼ŒæŸ”å’Œåœºæ™¯ |
| 30-60% | é€‚åº¦é”åŒ– | é£æ™¯ï¼Œå»ºç­‘ |
| 60-100% | å¼ºçƒˆé”åŒ– | æ–‡å­—ï¼Œäº§å“ |

---

## 3. å»é›¾

### ğŸ“– åŠŸèƒ½è¯´æ˜

**ä½œç”¨**ï¼šå»é™¤ç…§ç‰‡ä¸­çš„é›¾æ°”å’Œæœ¦èƒ§æ„Ÿï¼Œæé«˜æ¸…æ™°åº¦å’Œé€šé€æ„Ÿã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- é›¾å¤©æ‹æ‘„çš„ç…§ç‰‡
- è¿œæ™¯ä¸æ¸…æ™°çš„ç…§ç‰‡
- æ•´ä½“å‘ç°çš„ç…§ç‰‡
- éœ€è¦æé«˜é€šé€æ„Ÿçš„ç…§ç‰‡

**æ•ˆæœ**ï¼š
- æé«˜å¯¹æ¯”åº¦
- å¢å¼ºè‰²å½©é¥±å’Œåº¦
- æ¢å¤è¿œæ™¯ç»†èŠ‚
- æ•´ä½“æ›´é€šé€

### ğŸ”¬ ç®—æ³•åŸç†

#### æš—é€šé“å…ˆéªŒç®—æ³•ï¼ˆç®€åŒ–ç‰ˆï¼‰

**ä½•æºæ˜çš„æš—é€šé“å…ˆéªŒç†è®º**ï¼š
- æ— é›¾å›¾åƒçš„æš—é€šé“æ¥è¿‘0
- æœ‰é›¾å›¾åƒçš„æš—é€šé“å€¼è¾ƒå¤§
- é€šè¿‡æš—é€šé“ä¼°ç®—é€å°„ç‡ï¼Œæ¢å¤åŸå›¾

**ç®€åŒ–å®ç°**ï¼ˆä¸è®¡ç®—é€å°„å›¾ï¼‰ï¼š
```
1. å¢å¼ºå¯¹æ¯”åº¦ï¼ˆæ‹‰ä¼¸ç›´æ–¹å›¾ï¼‰
2. æå‡é¥±å’Œåº¦ï¼ˆæ¢å¤è‰²å½©ï¼‰
3. é€‚åº¦å¢åŠ äº®åº¦ï¼ˆè¡¥å¿æš—éƒ¨ï¼‰
4. é”åŒ–ç»†èŠ‚ï¼ˆå¢å¼ºæ¸…æ™°åº¦ï¼‰
```

#### å®ç°ä»£ç 

```java
public class DehazeFilter {
    
    /**
     * åº”ç”¨å»é›¾æ•ˆæœ
     * @param source åŸå§‹å›¾ç‰‡
     * @param intensity å¼ºåº¦ 0.0-1.0
     * @return å»é›¾åçš„å›¾ç‰‡
     */
    public static Bitmap apply(Bitmap source, float intensity) {
        // æ–¹æ¡ˆ1ï¼šç®€åŒ–ç‰ˆï¼ˆå¿«é€Ÿï¼‰
        return applySimple(source, intensity);
        
        // æ–¹æ¡ˆ2ï¼šæš—é€šé“ç‰ˆï¼ˆé«˜è´¨é‡ï¼Œè¾ƒæ…¢ï¼‰
        // return applyDarkChannel(source, intensity);
    }
    
    /**
     * ç®€åŒ–ç‰ˆå»é›¾ï¼ˆæ¨èï¼‰
     */
    private static Bitmap applySimple(Bitmap source, float intensity) {
        int width = source.getWidth();
        int height = source.getHeight();
        
        int[] pixels = new int[width * height];
        source.getPixels(pixels, 0, width, 0, 0, width, height);
        
        // 1. è®¡ç®—ç›´æ–¹å›¾
        int[] histR = new int[256];
        int[] histG = new int[256];
        int[] histB = new int[256];
        
        for (int pixel : pixels) {
            histR[(pixel >> 16) & 0xFF]++;
            histG[(pixel >> 8) & 0xFF]++;
            histB[pixel & 0xFF]++;
        }
        
        // 2. è®¡ç®—ç´¯ç§¯ç›´æ–¹å›¾ï¼ˆç”¨äºç›´æ–¹å›¾å‡è¡¡åŒ–ï¼‰
        int[] cumHistR = new int[256];
        int[] cumHistG = new int[256];
        int[] cumHistB = new int[256];
        
        cumHistR[0] = histR[0];
        cumHistG[0] = histG[0];
        cumHistB[0] = histB[0];
        
        for (int i = 1; i < 256; i++) {
            cumHistR[i] = cumHistR[i-1] + histR[i];
            cumHistG[i] = cumHistG[i-1] + histG[i];
            cumHistB[i] = cumHistB[i-1] + histB[i];
        }
        
        // 3. æ„å»ºæ˜ å°„è¡¨ï¼ˆå¯¹æ¯”åº¦æ‹‰ä¼¸ï¼‰
        int totalPixels = width * height;
        int[] mapR = new int[256];
        int[] mapG = new int[256];
        int[] mapB = new int[256];
        
        float stretchFactor = 1.0f + intensity * 0.5f;
        
        for (int i = 0; i < 256; i++) {
            // ç›´æ–¹å›¾å‡è¡¡åŒ–
            mapR[i] = (int)(255.0f * cumHistR[i] / totalPixels);
            mapG[i] = (int)(255.0f * cumHistG[i] / totalPixels);
            mapB[i] = (int)(255.0f * cumHistB[i] / totalPixels);
            
            // åº”ç”¨æ‹‰ä¼¸
            mapR[i] = (int)Math.min(255, (mapR[i] - 128) * stretchFactor + 128);
            mapG[i] = (int)Math.min(255, (mapG[i] - 128) * stretchFactor + 128);
            mapB[i] = (int)Math.min(255, (mapB[i] - 128) * stretchFactor + 128);
        }
        
        // 4. åº”ç”¨æ˜ å°„
        for (int i = 0; i < pixels.length; i++) {
            int pixel = pixels[i];
            int r = (pixel >> 16) & 0xFF;
            int g = (pixel >> 8) & 0xFF;
            int b = pixel & 0xFF;
            
            r = mapR[r];
            g = mapG[g];
            b = mapB[b];
            
            // å¢å¼ºé¥±å’Œåº¦
            float[] hsv = new float[3];
            android.graphics.Color.RGBToHSV(r, g, b, hsv);
            hsv[1] = Math.min(1.0f, hsv[1] * (1.0f + intensity * 0.3f));
            int color = android.graphics.Color.HSVToColor(hsv);
            
            r = (color >> 16) & 0xFF;
            g = (color >> 8) & 0xFF;
            b = color & 0xFF;
            
            // æ ¹æ®å¼ºåº¦æ··åˆ
            int origR = (pixel >> 16) & 0xFF;
            int origG = (pixel >> 8) & 0xFF;
            int origB = pixel & 0xFF;
            
            r = (int)(origR * (1 - intensity) + r * intensity);
            g = (int)(origG * (1 - intensity) + g * intensity);
            b = (int)(origB * (1 - intensity) + b * intensity);
            
            pixels[i] = (0xFF << 24) | (r << 16) | (g << 8) | b;
        }
        
        Bitmap result = Bitmap.createBitmap(width, height, source.getConfig());
        result.setPixels(pixels, 0, width, 0, 0, width, height);
        return result;
    }
}
```

### ğŸ’¡ å®ç°è¦ç‚¹

1. **ç›´æ–¹å›¾å‡è¡¡åŒ–**ï¼šå¢å¼ºå¯¹æ¯”åº¦
2. **é€‚åº¦å¢å¼º**ï¼šé¿å…è¿‡åº¦å¤„ç†å¯¼è‡´å¤±çœŸ
3. **ä¿ç•™ç»†èŠ‚**ï¼šä¸è¦ä¸¢å¤±æš—éƒ¨å’Œé«˜å…‰ä¿¡æ¯
4. **è‰²å½©æ¢å¤**ï¼šæå‡é¥±å’Œåº¦æ¢å¤åŸæœ‰è‰²å½©

### ğŸ¯ æ•ˆæœå¯¹æ¯”

| å¼ºåº¦ | å¯¹æ¯”åº¦ | é¥±å’Œåº¦ | é€‚ç”¨åœºæ™¯ |
|------|--------|--------|---------|
| 0-30% | +10% | +5% | è½»é›¾ |
| 30-60% | +20% | +10% | ä¸­é›¾ |
| 60-100% | +30% | +15% | é‡é›¾ |

---

## 4. æš—è§’

### ğŸ“– åŠŸèƒ½è¯´æ˜

**ä½œç”¨**ï¼šä½¿å›¾ç‰‡å››å‘¨é€æ¸å˜æš—ï¼Œçªå‡ºä¸­å¿ƒä¸»ä½“ï¼Œè¥é€ æ°›å›´æ„Ÿã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- äººåƒæ‘„å½±ï¼ˆçªå‡ºäººç‰©ï¼‰
- äº§å“æ‘„å½±ï¼ˆèšç„¦äº§å“ï¼‰
- è‰ºæœ¯æ•ˆæœï¼ˆå¤å¤æ„Ÿã€ç”µå½±æ„Ÿï¼‰
- å»é™¤æ‚ä¹±èƒŒæ™¯çš„è§†è§‰å¹²æ‰°

**æ•ˆæœ**ï¼š
- å››å‘¨è‡ªç„¶æ¸æš—
- ä¸­å¿ƒä¿æŒåŸäº®åº¦
- å¢åŠ ç…§ç‰‡å±‚æ¬¡æ„Ÿ
- è¥é€ ä¸“ä¸šæ‘„å½±æ„Ÿ

### ğŸ”¬ ç®—æ³•åŸç†

#### å¾„å‘æ¸å˜é®ç½©

```
æš—è§’åŸç†ï¼š
1. ä»¥å›¾ç‰‡ä¸­å¿ƒä¸ºåŸç‚¹
2. è®¡ç®—æ¯ä¸ªåƒç´ åˆ°ä¸­å¿ƒçš„è·ç¦»
3. è·ç¦»è¶Šè¿œï¼Œé™ä½äº®åº¦è¶Šå¤š
4. ä½¿ç”¨å¹³æ»‘çš„è¡°å‡å‡½æ•°
```

#### è¡°å‡å‡½æ•°

```java
// 1. çº¿æ€§è¡°å‡
brightness = 1.0f - (distance / maxDistance) * intensity;

// 2. äºŒæ¬¡è¡°å‡ï¼ˆæ¨èï¼Œæ›´è‡ªç„¶ï¼‰
brightness = 1.0f - Math.pow(distance / maxDistance, 2) * intensity;

// 3. æŒ‡æ•°è¡°å‡
brightness = (float)Math.exp(-distance / maxDistance * intensity * 3);
```

#### å®ç°ä»£ç 

```java
public class VignetteFilter {
    
    /**
     * åº”ç”¨æš—è§’æ•ˆæœ
     * @param source åŸå§‹å›¾ç‰‡
     * @param intensity å¼ºåº¦ 0.0-1.0
     * @param radius æš—è§’åŠå¾„ 0.5-1.5ï¼ˆç›¸å¯¹äºå›¾ç‰‡å°ºå¯¸ï¼‰
     * @return æ·»åŠ æš—è§’åçš„å›¾ç‰‡
     */
    public static Bitmap apply(Bitmap source, float intensity, float radius) {
        int width = source.getWidth();
        int height = source.getHeight();
        
        int[] pixels = new int[width * height];
        source.getPixels(pixels, 0, width, 0, 0, width, height);
        
        // è®¡ç®—ä¸­å¿ƒç‚¹å’Œæœ€å¤§è·ç¦»
        float centerX = width / 2.0f;
        float centerY = height / 2.0f;
        float maxDistance = (float)Math.sqrt(centerX * centerX + centerY * centerY);
        
        // è°ƒæ•´åŠå¾„
        float vignetteRadius = maxDistance * radius;
        
        // åº”ç”¨æš—è§’
        for (int y = 0; y < height; y++) {
            for (int x = 0; x < width; x++) {
                int index = y * width + x;
                int pixel = pixels[index];
                
                // è®¡ç®—åˆ°ä¸­å¿ƒçš„è·ç¦»
                float dx = x - centerX;
                float dy = y - centerY;
                float distance = (float)Math.sqrt(dx * dx + dy * dy);
                
                // è®¡ç®—äº®åº¦è¡°å‡ç³»æ•°
                float factor = 1.0f;
                if (distance > vignetteRadius) {
                    float normalizedDist = (distance - vignetteRadius) / 
                                         (maxDistance - vignetteRadius);
                    // ä½¿ç”¨äºŒæ¬¡è¡°å‡
                    factor = 1.0f - normalizedDist * normalizedDist * intensity;
                    factor = Math.max(0.2f, factor);  // æœ€æš—ä¸è¶…è¿‡80%
                }
                
                // åº”ç”¨åˆ°RGBé€šé“
                int r = (int)(((pixel >> 16) & 0xFF) * factor);
                int g = (int)(((pixel >> 8) & 0xFF) * factor);
                int b = (int)((pixel & 0xFF) * factor);
                
                pixels[index] = (0xFF << 24) | (r << 16) | (g << 8) | b;
            }
        }
        
        Bitmap result = Bitmap.createBitmap(width, height, source.getConfig());
        result.setPixels(pixels, 0, width, 0, 0, width, height);
        return result;
    }
    
    /**
     * é»˜è®¤åŠå¾„ç‰ˆæœ¬
     */
    public static Bitmap apply(Bitmap source, float intensity) {
        return apply(source, intensity, 0.7f);
    }
}
```

### ğŸ’¡ å®ç°è¦ç‚¹

1. **è‡ªç„¶è¿‡æ¸¡**ï¼šä½¿ç”¨äºŒæ¬¡æˆ–æŒ‡æ•°è¡°å‡
2. **ä¿ç•™ç»†èŠ‚**ï¼šæœ€æš—å¤„ä¸è¦å®Œå…¨å˜é»‘
3. **å¯è°ƒåŠå¾„**ï¼šæ”¯æŒè°ƒæ•´æš—è§’èŒƒå›´
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¯é¢„è®¡ç®—è·ç¦»å›¾

### ğŸ¯ å‚æ•°è¯´æ˜

| å‚æ•° | èŒƒå›´ | è¯´æ˜ |
|------|------|------|
| å¼ºåº¦ | 0-100% | æš—è§’æ·±åº¦ |
| åŠå¾„ | 0.5-1.5 | æš—è§’æ‰©æ•£èŒƒå›´ |

**æ¨èè®¾ç½®**ï¼š
- äººåƒï¼šå¼ºåº¦60%ï¼ŒåŠå¾„0.7
- é£æ™¯ï¼šå¼ºåº¦40%ï¼ŒåŠå¾„0.8
- äº§å“ï¼šå¼ºåº¦70%ï¼ŒåŠå¾„0.6

---

## 5. å…‰æ™•

### ğŸ“– åŠŸèƒ½è¯´æ˜

**ä½œç”¨**ï¼šåœ¨å›¾ç‰‡ä¸­å¿ƒæ·»åŠ æŸ”å’Œçš„å‘å…‰æ•ˆæœï¼Œè¥é€ æ¢¦å¹»ã€æ¸©æš–çš„æ°›å›´ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- æµªæ¼«æ°›å›´ç…§ç‰‡
- é€†å…‰æ•ˆæœæ¨¡æ‹Ÿ
- æ¢¦å¹»é£æ ¼
- æŸ”å’Œäººåƒ

**æ•ˆæœ**ï¼š
- ä¸­å¿ƒåŒºåŸŸæäº®
- å…‰çº¿å‘å¤–æ‰©æ•£
- æ•´ä½“æŸ”å’Œæ¢¦å¹»
- ç±»ä¼¼é•œå¤´å…‰æ™•

### ğŸ”¬ ç®—æ³•åŸç†

#### é«˜æ–¯æ¨¡ç³Š + åŠ æ³•æ··åˆ

```
å…‰æ™•åŸç†ï¼š
1. æå–å›¾ç‰‡é«˜å…‰éƒ¨åˆ†
2. å¯¹é«˜å…‰è¿›è¡Œé«˜æ–¯æ¨¡ç³Š
3. å åŠ å›åŸå›¾ï¼ˆåŠ æ³•æ··åˆï¼‰
4. ä¸­å¿ƒåŒºåŸŸé¢å¤–æäº®
```

#### å®ç°æ­¥éª¤

```
åŸå›¾ â†’ æå–é«˜å…‰ â†’ é«˜æ–¯æ¨¡ç³Š â†’ å åŠ  â†’ å…‰æ™•æ•ˆæœ
              â†“
         ä¸­å¿ƒæäº®é®ç½©
```

#### å®ç°ä»£ç 

```java
public class GlowFilter {
    
    /**
     * åº”ç”¨å…‰æ™•æ•ˆæœ
     * @param source åŸå§‹å›¾ç‰‡
     * @param intensity å¼ºåº¦ 0.0-1.0
     * @return æ·»åŠ å…‰æ™•åçš„å›¾ç‰‡
     */
    public static Bitmap apply(Bitmap source, float intensity) {
        int width = source.getWidth();
        int height = source.getHeight();
        
        // 1. åˆ›å»ºä¸­å¿ƒæäº®é®ç½©
        float[] mask = createGlowMask(width, height);
        
        // 2. æå–å¹¶æ¨¡ç³Šé«˜å…‰
        Bitmap blurred = extractAndBlurHighlights(source, intensity);
        
        // 3. æ··åˆ
        int[] srcPixels = new int[width * height];
        int[] blurPixels = new int[width * height];
        source.getPixels(srcPixels, 0, width, 0, 0, width, height);
        blurred.getPixels(blurPixels, 0, width, 0, 0, width, height);
        
        int[] resultPixels = new int[width * height];
        
        for (int i = 0; i < srcPixels.length; i++) {
            int srcPixel = srcPixels[i];
            int blurPixel = blurPixels[i];
            
            int srcR = (srcPixel >> 16) & 0xFF;
            int srcG = (srcPixel >> 8) & 0xFF;
            int srcB = srcPixel & 0xFF;
            
            int blurR = (blurPixel >> 16) & 0xFF;
            int blurG = (blurPixel >> 8) & 0xFF;
            int blurB = blurPixel & 0xFF;
            
            // åŠ æ³•æ··åˆï¼ˆå åŠ å…‰æ™•ï¼‰
            float maskValue = mask[i] * intensity;
            int r = (int)Math.min(255, srcR + blurR * maskValue);
            int g = (int)Math.min(255, srcG + blurG * maskValue);
            int b = (int)Math.min(255, srcB + blurB * maskValue);
            
            resultPixels[i] = (0xFF << 24) | (r << 16) | (g << 8) | b;
        }
        
        Bitmap result = Bitmap.createBitmap(width, height, source.getConfig());
        result.setPixels(resultPixels, 0, width, 0, 0, width, height);
        
        blurred.recycle();
        return result;
    }
    
    /**
     * åˆ›å»ºå…‰æ™•é®ç½©ï¼ˆä¸­å¿ƒäº®ï¼Œè¾¹ç¼˜æš—ï¼‰
     */
    private static float[] createGlowMask(int width, int height) {
        float[] mask = new float[width * height];
        float centerX = width / 2.0f;
        float centerY = height / 2.0f;
        float maxDist = (float)Math.sqrt(centerX * centerX + centerY * centerY);
        
        for (int y = 0; y < height; y++) {
            for (int x = 0; x < width; x++) {
                float dx = x - centerX;
                float dy = y - centerY;
                float dist = (float)Math.sqrt(dx * dx + dy * dy);
                
                // é«˜æ–¯åˆ†å¸ƒ
                mask[y * width + x] = (float)Math.exp(-dist * dist / 
                                                     (2 * maxDist * maxDist * 0.3));
            }
        }
        
        return mask;
    }
    
    /**
     * æå–é«˜å…‰å¹¶æ¨¡ç³Š
     */
    private static Bitmap extractAndBlurHighlights(Bitmap source, float intensity) {
        int width = source.getWidth();
        int height = source.getHeight();
        
        int[] pixels = new int[width * height];
        source.getPixels(pixels, 0, width, 0, 0, width, height);
        
        // æå–é«˜å…‰ï¼ˆäº®åº¦ > 180ï¼‰
        for (int i = 0; i < pixels.length; i++) {
            int pixel = pixels[i];
            int r = (pixel >> 16) & 0xFF;
            int g = (pixel >> 8) & 0xFF;
            int b = pixel & 0xFF;
            
            int brightness = (int)(0.299 * r + 0.587 * g + 0.114 * b);
            
            if (brightness > 180) {
                // ä¿ç•™é«˜å…‰
                float factor = (brightness - 180) / 75.0f;
                r = (int)(r * factor);
                g = (int)(g * factor);
                b = (int)(b * factor);
            } else {
                // ç§»é™¤éé«˜å…‰
                r = g = b = 0;
            }
            
            pixels[i] = (0xFF << 24) | (r << 16) | (g << 8) | b;
        }
        
        Bitmap highlights = Bitmap.createBitmap(width, height, source.getConfig());
        highlights.setPixels(pixels, 0, width, 0, 0, width, height);
        
        // é«˜æ–¯æ¨¡ç³Š
        int blurRadius = (int)(Math.min(width, height) * 0.05f * intensity);
        blurRadius = Math.max(5, Math.min(25, blurRadius));
        
        Bitmap blurred = gaussianBlur(highlights, blurRadius);
        highlights.recycle();
        
        return blurred;
    }
    
    /**
     * é«˜æ–¯æ¨¡ç³Šï¼ˆç®€åŒ–ç‰ˆï¼‰
     */
    private static Bitmap gaussianBlur(Bitmap source, int radius) {
        // å¯ä»¥ä½¿ç”¨RenderScriptåŠ é€Ÿ
        // è¿™é‡Œä½¿ç”¨ç®€åŒ–çš„box blur
        return boxBlur(source, radius);
    }
    
    /**
     * Box Blurï¼ˆå¿«é€Ÿæ¨¡ç³Šï¼‰
     */
    private static Bitmap boxBlur(Bitmap source, int radius) {
        int width = source.getWidth();
        int height = source.getHeight();
        
        int[] pixels = new int[width * height];
        source.getPixels(pixels, 0, width, 0, 0, width, height);
        
        // æ°´å¹³æ¨¡ç³Š
        int[] temp = new int[width * height];
        for (int y = 0; y < height; y++) {
            for (int x = 0; x < width; x++) {
                int r = 0, g = 0, b = 0, count = 0;
                
                for (int kx = -radius; kx <= radius; kx++) {
                    int px = Math.max(0, Math.min(width - 1, x + kx));
                    int pixel = pixels[y * width + px];
                    r += (pixel >> 16) & 0xFF;
                    g += (pixel >> 8) & 0xFF;
                    b += pixel & 0xFF;
                    count++;
                }
                
                temp[y * width + x] = (0xFF << 24) | 
                                     ((r / count) << 16) | 
                                     ((g / count) << 8) | 
                                     (b / count);
            }
        }
        
        // å‚ç›´æ¨¡ç³Š
        int[] result = new int[width * height];
        for (int y = 0; y < height; y++) {
            for (int x = 0; x < width; x++) {
                int r = 0, g = 0, b = 0, count = 0;
                
                for (int ky = -radius; ky <= radius; ky++) {
                    int py = Math.max(0, Math.min(height - 1, y + ky));
                    int pixel = temp[py * width + x];
                    r += (pixel >> 16) & 0xFF;
                    g += (pixel >> 8) & 0xFF;
                    b += pixel & 0xFF;
                    count++;
                }
                
                result[y * width + x] = (0xFF << 24) | 
                                       ((r / count) << 16) | 
                                       ((g / count) << 8) | 
                                       (b / count);
            }
        }
        
        Bitmap blurred = Bitmap.createBitmap(width, height, source.getConfig());
        blurred.setPixels(result, 0, width, 0, 0, width, height);
        return blurred;
    }
}
```

### ğŸ’¡ å®ç°è¦ç‚¹

1. **æå–é«˜å…‰**ï¼šåªå¯¹æ˜äº®åŒºåŸŸäº§ç”Ÿå…‰æ™•
2. **é€‚åº¦æ¨¡ç³Š**ï¼šæ¨¡ç³ŠåŠå¾„æ ¹æ®å›¾ç‰‡å°ºå¯¸è‡ªé€‚åº”
3. **åŠ æ³•æ··åˆ**ï¼šé¿å…è¦†ç›–åŸå›¾ç»†èŠ‚
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨RenderScriptåŠ é€Ÿæ¨¡ç³Š

### ğŸ¯ å‚æ•°è¯´æ˜

| å‚æ•° | æ•ˆæœ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| 0-30% | è½»å¾®å‘å…‰ | æ—¥å¸¸ç…§ç‰‡ |
| 30-60% | æ˜æ˜¾å…‰æ™• | é€†å…‰ã€æ¢¦å¹» |
| 60-100% | å¼ºçƒˆå…‰æ•ˆ | è‰ºæœ¯æ•ˆæœ |

---

## 6. æŸ”ç„¦

### ğŸ“– åŠŸèƒ½è¯´æ˜

**ä½œç”¨**ï¼šä½¿èƒŒæ™¯æˆ–è¾¹ç¼˜åŒºåŸŸæ¨¡ç³Šï¼Œçªå‡ºä¸­å¿ƒä¸»ä½“ï¼Œæ¨¡æ‹Ÿå¤§å…‰åœˆæ•ˆæœã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- äººåƒæ‘„å½±ï¼ˆçªå‡ºäººç‰©ï¼‰
- äº§å“æ‘„å½±ï¼ˆèšç„¦äº§å“ï¼‰
- æ¨¡æ‹Ÿæ™¯æ·±æ•ˆæœ
- å»é™¤èƒŒæ™¯å¹²æ‰°

**æ•ˆæœ**ï¼š
- ä¸­å¿ƒæ¸…æ™°
- å››å‘¨é€æ¸æ¨¡ç³Š
- ç±»ä¼¼å¤§å…‰åœˆè™šåŒ–
- å¢åŠ ç©ºé—´æ„Ÿ

### ğŸ”¬ ç®—æ³•åŸç†

#### å¾„å‘æ¨¡ç³Š

```
æŸ”ç„¦åŸç†ï¼š
1. ä»¥å›¾ç‰‡ä¸­å¿ƒä¸ºç„¦ç‚¹
2. è®¡ç®—æ¯ä¸ªåƒç´ åˆ°ä¸­å¿ƒçš„è·ç¦»
3. è·ç¦»è¶Šè¿œï¼Œæ¨¡ç³Šç¨‹åº¦è¶Šé«˜
4. ä½¿ç”¨å¯å˜åŠå¾„é«˜æ–¯æ¨¡ç³Š
```

#### å®ç°ä»£ç 

```java
public class SoftFocusFilter {
    
    /**
     * åº”ç”¨æŸ”ç„¦æ•ˆæœ
     * @param source åŸå§‹å›¾ç‰‡
     * @param intensity å¼ºåº¦ 0.0-1.0
     * @param focusSize ç„¦ç‚¹å¤§å° 0.3-0.8
     * @return æŸ”ç„¦åçš„å›¾ç‰‡
     */
    public static Bitmap apply(Bitmap source, float intensity, float focusSize) {
        int width = source.getWidth();
        int height = source.getHeight();
        
        // 1. åˆ›å»ºå¤šå±‚æ¨¡ç³Šå›¾
        Bitmap[] blurLevels = new Bitmap[5];
        blurLevels[0] = source;  // åŸå›¾ï¼ˆæ— æ¨¡ç³Šï¼‰
        
        for (int i = 1; i < 5; i++) {
            int radius = i * 5;  // 5, 10, 15, 20
            blurLevels[i] = gaussianBlur(source, radius);
        }
        
        // 2. åˆ›å»ºæ¨¡ç³Šé®ç½©
        float[] blurMask = createBlurMask(width, height, focusSize);
        
        // 3. æ··åˆä¸åŒæ¨¡ç³Šå±‚
        int[] pixels = new int[width * height];
        
        for (int i = 0; i < pixels.length; i++) {
            float blurAmount = blurMask[i] * intensity;
            
            // é€‰æ‹©æ¨¡ç³Šå±‚
            int level = (int)(blurAmount * 4);
            float blend = (blurAmount * 4) - level;
            
            level = Math.min(3, level);
            
            // è·å–ä¸¤å±‚åƒç´ 
            int[] pixels1 = new int[1];
            int[] pixels2 = new int[1];
            int x = i % width;
            int y = i / width;
            
            blurLevels[level].getPixels(pixels1, 0, 1, x, y, 1, 1);
            blurLevels[level + 1].getPixels(pixels2, 0, 1, x, y, 1, 1);
            
            // æ··åˆ
            int p1 = pixels1[0];
            int p2 = pixels2[0];
            
            int r = (int)(((p1 >> 16) & 0xFF) * (1 - blend) + 
                         ((p2 >> 16) & 0xFF) * blend);
            int g = (int)(((p1 >> 8) & 0xFF) * (1 - blend) + 
                         ((p2 >> 8) & 0xFF) * blend);
            int b = (int)((p1 & 0xFF) * (1 - blend) + 
                         (p2 & 0xFF) * blend);
            
            pixels[i] = (0xFF << 24) | (r << 16) | (g << 8) | b;
        }
        
        // 4. åˆ›å»ºç»“æœ
        Bitmap result = Bitmap.createBitmap(width, height, source.getConfig());
        result.setPixels(pixels, 0, width, 0, 0, width, height);
        
        // 5. é‡Šæ”¾æ¨¡ç³Šå±‚
        for (int i = 1; i < 5; i++) {
            blurLevels[i].recycle();
        }
        
        return result;
    }
    
    /**
     * åˆ›å»ºæ¨¡ç³Šé®ç½©ï¼ˆä¸­å¿ƒ0ï¼Œè¾¹ç¼˜1ï¼‰
     */
    private static float[] createBlurMask(int width, int height, float focusSize) {
        float[] mask = new float[width * height];
        float centerX = width / 2.0f;
        float centerY = height / 2.0f;
        float maxDist = (float)Math.sqrt(centerX * centerX + centerY * centerY);
        float focusRadius = maxDist * focusSize;
        
        for (int y = 0; y < height; y++) {
            for (int x = 0; x < width; x++) {
                float dx = x - centerX;
                float dy = y - centerY;
                float dist = (float)Math.sqrt(dx * dx + dy * dy);
                
                if (dist <= focusRadius) {
                    mask[y * width + x] = 0;  // ç„¦ç‚¹å†…ï¼šæ¸…æ™°
                } else {
                    // ç„¦ç‚¹å¤–ï¼šæ ¹æ®è·ç¦»æ¨¡ç³Š
                    float normalizedDist = (dist - focusRadius) / 
                                          (maxDist - focusRadius);
                    mask[y * width + x] = normalizedDist;
                }
            }
        }
        
        return mask;
    }
    
    /**
     * é«˜æ–¯æ¨¡ç³Šï¼ˆåŒå…‰æ™•æ»¤é•œï¼‰
     */
    private static Bitmap gaussianBlur(Bitmap source, int radius) {
        // å®ç°è§å…‰æ™•æ»¤é•œéƒ¨åˆ†
        return boxBlur(source, radius);
    }
    
    /**
     * é»˜è®¤ç„¦ç‚¹å¤§å°ç‰ˆæœ¬
     */
    public static Bitmap apply(Bitmap source, float intensity) {
        return apply(source, intensity, 0.5f);
    }
}
```

### ğŸ’¡ å®ç°è¦ç‚¹

1. **å¤šå±‚æ¨¡ç³Š**ï¼šé¢„å…ˆåˆ›å»ºä¸åŒæ¨¡ç³Šç¨‹åº¦çš„å›¾å±‚
2. **å¹³æ»‘è¿‡æ¸¡**ï¼šä½¿ç”¨æ’å€¼æ··åˆä¸åŒæ¨¡ç³Šå±‚
3. **å¯è°ƒç„¦ç‚¹**ï¼šæ”¯æŒè°ƒæ•´æ¸…æ™°åŒºåŸŸå¤§å°
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ¨¡ç³Šæ“ä½œä½¿ç”¨RenderScript

### ğŸ¯ å‚æ•°è¯´æ˜

| å‚æ•° | èŒƒå›´ | è¯´æ˜ |
|------|------|------|
| å¼ºåº¦ | 0-100% | æ¨¡ç³Šç¨‹åº¦ |
| ç„¦ç‚¹å¤§å° | 0.3-0.8 | æ¸…æ™°åŒºåŸŸå¤§å° |

**æ¨èè®¾ç½®**ï¼š
- äººåƒï¼šå¼ºåº¦70%ï¼Œç„¦ç‚¹0.5
- äº§å“ï¼šå¼ºåº¦80%ï¼Œç„¦ç‚¹0.4
- é£æ™¯ï¼šå¼ºåº¦50%ï¼Œç„¦ç‚¹0.6

---

## UIè®¾è®¡

### å¸ƒå±€ç»“æ„

```xml
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¾åŒ–                          âœ•   â”‚  â† æ ‡é¢˜æ 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  [âš¡è‡ªåŠ¨å¢å¼º]  [ğŸ”é”åŒ–]  [ğŸŒ«ï¸å»é›¾]    â”‚  â† åŠŸèƒ½æŒ‰é’®ï¼ˆç¬¬ä¸€è¡Œï¼‰
â”‚                                     â”‚
â”‚  [ğŸ­æš—è§’]     [âœ¨å…‰æ™•]  [ğŸŒ¸æŸ”ç„¦]    â”‚  â† åŠŸèƒ½æŒ‰é’®ï¼ˆç¬¬äºŒè¡Œï¼‰
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¼ºåº¦                          80%  â”‚  â† å¼ºåº¦æ ‡ç­¾
â”‚ â”â”â”â”â”â”â”â”â”â”â—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚  â† æ»‘å—
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ é‡ç½® ]         [ åº”ç”¨ ]         â”‚  â† æ“ä½œæŒ‰é’®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¸ƒå±€æ–‡ä»¶

```xml
<!-- panel_beautify.xml -->
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:id="@+id/beautify_panel"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical"
    android:background="#1A1A1A"
    android:visibility="gone">
    
    <!-- æ ‡é¢˜æ  -->
    <RelativeLayout
        android:layout_width="match_parent"
        android:layout_height="56dp"
        android:paddingHorizontal="16dp">
        
        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="ç¾åŒ–"
            android:textColor="@color/white"
            android:textSize="18sp"
            android:textStyle="bold"
            android:layout_centerVertical="true"/>
        
        <TextView
            android:id="@+id/btn_beautify_close"
            android:layout_width="40dp"
            android:layout_height="40dp"
            android:text="âœ•"
            android:textColor="@color/white"
            android:textSize="20sp"
            android:gravity="center"
            android:layout_alignParentEnd="true"
            android:layout_centerVertical="true"
            android:clickable="true"
            android:background="?attr/selectableItemBackgroundBorderless"/>
    </RelativeLayout>
    
    <!-- åŠŸèƒ½æŒ‰é’®ç½‘æ ¼ -->
    <GridLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:columnCount="3"
        android:rowCount="2"
        android:padding="16dp">
        
        <!-- è‡ªåŠ¨å¢å¼º -->
        <LinearLayout
            android:id="@+id/btn_auto_enhance"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_columnWeight="1"
            android:orientation="vertical"
            android:gravity="center"
            android:padding="12dp"
            android:clickable="true"
            android:background="@drawable/beautify_button_bg">
            
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="âš¡"
                android:textSize="32sp"/>
            
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="è‡ªåŠ¨å¢å¼º"
                android:textColor="@color/white"
                android:textSize="12sp"
                android:layout_marginTop="4dp"/>
        </LinearLayout>
        
        <!-- é”åŒ– -->
        <LinearLayout
            android:id="@+id/btn_sharpen"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_columnWeight="1"
            android:orientation="vertical"
            android:gravity="center"
            android:padding="12dp"
            android:clickable="true"
            android:background="@drawable/beautify_button_bg">
            
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="ğŸ”"
                android:textSize="32sp"/>
            
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="é”åŒ–"
                android:textColor="@color/white"
                android:textSize="12sp"
                android:layout_marginTop="4dp"/>
        </LinearLayout>
        
        <!-- å»é›¾ -->
        <LinearLayout
            android:id="@+id/btn_dehaze"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_columnWeight="1"
            android:orientation="vertical"
            android:gravity="center"
            android:padding="12dp"
            android:clickable="true"
            android:background="@drawable/beautify_button_bg">
            
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="ğŸŒ«ï¸"
                android:textSize="32sp"/>
            
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="å»é›¾"
                android:textColor="@color/white"
                android:textSize="12sp"
                android:layout_marginTop="4dp"/>
        </LinearLayout>
        
        <!-- æš—è§’ -->
        <LinearLayout
            android:id="@+id/btn_vignette"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_columnWeight="1"
            android:orientation="vertical"
            android:gravity="center"
            android:padding="12dp"
            android:clickable="true"
            android:background="@drawable/beautify_button_bg">
            
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="ğŸ­"
                android:textSize="32sp"/>
            
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="æš—è§’"
                android:textColor="@color/white"
                android:textSize="12sp"
                android:layout_marginTop="4dp"/>
        </LinearLayout>
        
        <!-- å…‰æ™• -->
        <LinearLayout
            android:id="@+id/btn_glow"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_columnWeight="1"
            android:orientation="vertical"
            android:gravity="center"
            android:padding="12dp"
            android:clickable="true"
            android:background="@drawable/beautify_button_bg">
            
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="âœ¨"
                android:textSize="32sp"/>
            
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="å…‰æ™•"
                android:textColor="@color/white"
                android:textSize="12sp"
                android:layout_marginTop="4dp"/>
        </LinearLayout>
        
        <!-- æŸ”ç„¦ -->
        <LinearLayout
            android:id="@+id/btn_soft_focus"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_columnWeight="1"
            android:orientation="vertical"
            android:gravity="center"
            android:padding="12dp"
            android:clickable="true"
            android:background="@drawable/beautify_button_bg">
            
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="ğŸŒ¸"
                android:textSize="32sp"/>
            
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="æŸ”ç„¦"
                android:textColor="@color/white"
                android:textSize="12sp"
                android:layout_marginTop="4dp"/>
        </LinearLayout>
    </GridLayout>
    
    <!-- å¼ºåº¦è°ƒèŠ‚ -->
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:paddingHorizontal="20dp"
        android:paddingVertical="12dp"
        android:background="#252525">
        
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:layout_marginBottom="8dp">
            
            <TextView
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:text="å¼ºåº¦"
                android:textColor="@color/white"
                android:textSize="14sp"/>
            
            <TextView
                android:id="@+id/text_beautify_intensity"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="80%"
                android:textColor="#FFD700"
                android:textSize="16sp"
                android:textStyle="bold"/>
        </LinearLayout>
        
        <SeekBar
            android:id="@+id/seekbar_beautify_intensity"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:max="100"
            android:progress="80"
            android:progressTint="#FFD700"
            android:thumbTint="#FFD700"/>
    </LinearLayout>
    
    <!-- åº•éƒ¨æŒ‰é’® -->
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:padding="16dp">
        
        <Button
            android:id="@+id/btn_beautify_reset"
            android:layout_width="0dp"
            android:layout_height="48dp"
            android:layout_weight="1"
            android:text="é‡ç½®"
            android:textColor="@color/white"
            android:textSize="16sp"
            android:background="@drawable/rounded_button_dark_bg"
            android:layout_marginEnd="8dp"/>
        
        <Button
            android:id="@+id/btn_beautify_apply"
            android:layout_width="0dp"
            android:layout_height="48dp"
            android:layout_weight="1"
            android:text="åº”ç”¨"
            android:textColor="@color/black"
            android:textSize="16sp"
            android:background="#FFD700"
            android:layout_marginStart="8dp"/>
    </LinearLayout>
    
</LinearLayout>
```

### æŒ‰é’®èƒŒæ™¯

```xml
<!-- drawable/beautify_button_bg.xml -->
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">
    <item android:state_pressed="true">
        <shape>
            <solid android:color="#FFD700"/>
            <corners android:radius="8dp"/>
        </shape>
    </item>
    <item android:state_selected="true">
        <shape>
            <solid android:color="#3A3A3A"/>
            <stroke android:width="2dp" android:color="#FFD700"/>
            <corners android:radius="8dp"/>
        </shape>
    </item>
    <item>
        <shape>
            <solid android:color="#2A2A2A"/>
            <corners android:radius="8dp"/>
        </shape>
    </item>
</selector>
```

---

## å®ç°æ¶æ„

### åŒ…ç»“æ„

```
app/src/main/java/com/example/photoshop_demo/beautify/
â”œâ”€â”€ BeautifyEffect.java          # æšä¸¾ï¼š6ç§ç¾åŒ–æ•ˆæœ
â”œâ”€â”€ AutoEnhanceFilter.java       # è‡ªåŠ¨å¢å¼º
â”œâ”€â”€ SharpenFilter.java           # é”åŒ–
â”œâ”€â”€ DehazeFilter.java            # å»é›¾
â”œâ”€â”€ VignetteFilter.java          # æš—è§’
â”œâ”€â”€ GlowFilter.java              # å…‰æ™•
â”œâ”€â”€ SoftFocusFilter.java         # æŸ”ç„¦
â””â”€â”€ BeautifyManager.java         # ç®¡ç†å™¨ï¼ˆç»Ÿä¸€æ¥å£ï¼‰
```

### BeautifyEffectæšä¸¾

```java
public enum BeautifyEffect {
    AUTO_ENHANCE("âš¡", "è‡ªåŠ¨å¢å¼º"),
    SHARPEN("ğŸ”", "é”åŒ–"),
    DEHAZE("ğŸŒ«ï¸", "å»é›¾"),
    VIGNETTE("ğŸ­", "æš—è§’"),
    GLOW("âœ¨", "å…‰æ™•"),
    SOFT_FOCUS("ğŸŒ¸", "æŸ”ç„¦");
    
    private final String icon;
    private final String name;
    
    BeautifyEffect(String icon, String name) {
        this.icon = icon;
        this.name = name;
    }
    
    public String getIcon() { return icon; }
    public String getName() { return name; }
}
```

### BeautifyManager

```java
public class BeautifyManager {
    
    public static Bitmap applyEffect(Bitmap source, BeautifyEffect effect, 
                                     float intensity) {
        switch (effect) {
            case AUTO_ENHANCE:
                return AutoEnhanceFilter.apply(source, intensity);
            case SHARPEN:
                return SharpenFilter.apply(source, intensity);
            case DEHAZE:
                return DehazeFilter.apply(source, intensity);
            case VIGNETTE:
                return VignetteFilter.apply(source, intensity);
            case GLOW:
                return GlowFilter.apply(source, intensity);
            case SOFT_FOCUS:
                return SoftFocusFilter.apply(source, intensity);
            default:
                return source;
        }
    }
}
```

---

## æ€§èƒ½ä¼˜åŒ–

### 1. ä½¿ç”¨RenderScript

```java
// é«˜æ–¯æ¨¡ç³ŠåŠ é€Ÿ
public static Bitmap fastBlur(Context context, Bitmap source, int radius) {
    RenderScript rs = RenderScript.create(context);
    
    Allocation input = Allocation.createFromBitmap(rs, source);
    Allocation output = Allocation.createTyped(rs, input.getType());
    
    ScriptIntrinsicBlur script = ScriptIntrinsicBlur.create(
        rs, Element.U8_4(rs));
    script.setRadius(radius);
    script.setInput(input);
    script.forEach(output);
    
    output.copyTo(source);
    
    input.destroy();
    output.destroy();
    script.destroy();
    rs.destroy();
    
    return source;
}
```

### 2. å¤šçº¿ç¨‹å¤„ç†

```java
// åˆ†å—å¤„ç†å¤§å›¾
ExecutorService executor = Executors.newFixedThreadPool(4);
List<Future<?>> futures = new ArrayList<>();

for (int i = 0; i < 4; i++) {
    final int blockIndex = i;
    futures.add(executor.submit(() -> {
        // å¤„ç†ç¬¬blockIndexå—
    }));
}

// ç­‰å¾…å®Œæˆ
for (Future<?> future : futures) {
    future.get();
}
```

### 3. ç¼“å­˜ä¼˜åŒ–

```java
// ç¼“å­˜ä¸­é—´ç»“æœ
private Map<String, Bitmap> cache = new LruCache<>(10 * 1024 * 1024);

public Bitmap applyWithCache(Bitmap source, BeautifyEffect effect, 
                             float intensity) {
    String key = effect.name() + "_" + intensity;
    Bitmap cached = cache.get(key);
    if (cached != null) return cached;
    
    Bitmap result = applyEffect(source, effect, intensity);
    cache.put(key, result);
    return result;
}
```

### 4. é™é‡‡æ ·é¢„è§ˆ

```java
// é¢„è§ˆæ—¶ä½¿ç”¨å°å›¾
Bitmap preview = Bitmap.createScaledBitmap(
    source, 
    source.getWidth() / 4, 
    source.getHeight() / 4, 
    true
);

// åº”ç”¨æ•ˆæœåˆ°å°å›¾
Bitmap previewResult = applyEffect(preview, effect, intensity);

// å®é™…åº”ç”¨æ—¶ä½¿ç”¨åŸå›¾
Bitmap finalResult = applyEffect(source, effect, intensity);
```

---

## æ€»ç»“

### 6ä¸ªåŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | å¤æ‚åº¦ | æ€§èƒ½ | æ•ˆæœ | æ¨èåº¦ |
|------|--------|------|------|--------|
| è‡ªåŠ¨å¢å¼º | â­â­ | å¿« | æ˜æ˜¾ | â­â­â­â­â­ |
| é”åŒ– | â­â­ | ä¸­ | æ˜æ˜¾ | â­â­â­â­ |
| å»é›¾ | â­â­â­ | ä¸­ | æ˜æ˜¾ | â­â­â­â­ |
| æš—è§’ | â­ | å¿« | æ˜æ˜¾ | â­â­â­â­ |
| å…‰æ™• | â­â­â­ | æ…¢ | è‰ºæœ¯ | â­â­â­ |
| æŸ”ç„¦ | â­â­â­ | æ…¢ | æ˜æ˜¾ | â­â­â­â­ |

### å®ç°ä¼˜å…ˆçº§

**ç¬¬ä¸€æ‰¹**ï¼ˆå¿…é¡»ï¼‰ï¼š
1. è‡ªåŠ¨å¢å¼º - æœ€å¸¸ç”¨
2. é”åŒ– - ç®€å•å®ç”¨
3. æš—è§’ - ç®€å•æœ‰æ•ˆ

**ç¬¬äºŒæ‰¹**ï¼ˆæ¨èï¼‰ï¼š
4. å»é›¾ - ç‰¹å®šåœºæ™¯å¾ˆæœ‰ç”¨
5. æŸ”ç„¦ - äººåƒå¿…å¤‡

**ç¬¬ä¸‰æ‰¹**ï¼ˆå¯é€‰ï¼‰ï¼š
6. å…‰æ™• - è‰ºæœ¯æ•ˆæœ

### é¢„ä¼°å·¥ä½œé‡

- **ä»£ç é‡**ï¼š~1000è¡Œ
- **æ—¶é—´**ï¼š2-3å°æ—¶
- **éš¾ç‚¹**ï¼šé«˜æ–¯æ¨¡ç³Šæ€§èƒ½ä¼˜åŒ–

---

**å‡†å¤‡å¥½å¼€å§‹å®ç°äº†å—ï¼Ÿ** ğŸš€

