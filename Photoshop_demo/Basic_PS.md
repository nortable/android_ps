# ç¬¬ä¸‰é˜¶æ®µæ•™å­¦ï¼šå›¾ç‰‡åŸºæœ¬ç¼–è¾‘åŠŸèƒ½å®ç°

## ğŸ“š ç›®å½•
1. [åŠŸèƒ½æ¦‚è¿°](#1-åŠŸèƒ½æ¦‚è¿°)
2. [å›¾ç‰‡å¤„ç†åŸç†](#2-å›¾ç‰‡å¤„ç†åŸç†)
3. [è£åˆ‡åŠŸèƒ½å®ç°](#3-è£åˆ‡åŠŸèƒ½å®ç°)
4. [äº®åº¦è°ƒæ•´å®ç°](#4-äº®åº¦è°ƒæ•´å®ç°)
5. [å¯¹æ¯”åº¦è°ƒæ•´å®ç°](#5-å¯¹æ¯”åº¦è°ƒæ•´å®ç°)
6. [é¥±å’Œåº¦è°ƒæ•´å®ç°](#6-é¥±å’Œåº¦è°ƒæ•´å®ç°)
7. [UIè®¾è®¡æ–¹æ¡ˆ](#7-uiè®¾è®¡æ–¹æ¡ˆ)
8. [å®Œæ•´å®ç°æ­¥éª¤](#8-å®Œæ•´å®ç°æ­¥éª¤)
9. [æ€§èƒ½ä¼˜åŒ–](#9-æ€§èƒ½ä¼˜åŒ–)
10. [æœ€ä½³å®è·µ](#10-æœ€ä½³å®è·µ)

---

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 è¦å®ç°çš„åŠŸèƒ½åˆ—è¡¨

| åŠŸèƒ½ | è¯´æ˜ | éš¾åº¦ | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| **è£åˆ‡** | é€‰æ‹©åŒºåŸŸè£å‰ªå›¾ç‰‡ | â­â­â­ | é«˜ |
| **äº®åº¦** | è°ƒæ•´å›¾ç‰‡æ˜æš— | â­â­ | é«˜ |
| **å¯¹æ¯”åº¦** | è°ƒæ•´æ˜æš—å¯¹æ¯” | â­â­ | é«˜ |
| **é¥±å’Œåº¦** | è°ƒæ•´è‰²å½©é²œè‰³åº¦ | â­â­ | ä¸­ |
| **æ—‹è½¬** | 90åº¦æ—‹è½¬/ç¿»è½¬ | â­ | ä¸­ |
| **è‰²æ¸©** | è°ƒæ•´å†·æš–è‰²è°ƒ | â­â­ | ä½ |

### 1.2 ç”¨æˆ·äº¤äº’è®¾è®¡

```
ç¼–è¾‘é¡µé¢å¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† â†¶ â‹¯ â­AI ã€å¯¼å‡ºã€‘      â”‚ é¡¶éƒ¨å·¥å…·æ 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          â”‚
â”‚      [å›¾ç‰‡æ˜¾ç¤ºåŒºåŸŸ]       â”‚ ä¸­å¤®æ˜¾ç¤ºåŒº
â”‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ äº®åº¦ [---------â—---] +50 â”‚ è°ƒæ•´æ»‘å—
â”‚ å¯¹æ¯” [-----------â—-] +30 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [è£åˆ‡][æ—‹è½¬][æ»¤é•œ][è°ƒæ•´] â”‚ åŠŸèƒ½æ ‡ç­¾
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. å›¾ç‰‡å¤„ç†åŸç†

### 2.1 BitmapåŸºç¡€çŸ¥è¯†

#### ä»€ä¹ˆæ˜¯Bitmapï¼Ÿ
```
Bitmapæ˜¯Androidä¸­è¡¨ç¤ºä½å›¾çš„ç±»
ä½å›¾ = åƒç´ çŸ©é˜µ

ä¾‹å¦‚ï¼š100x100çš„å›¾ç‰‡ = 10,000ä¸ªåƒç´ ç‚¹
æ¯ä¸ªåƒç´ å­˜å‚¨ARGBå€¼ï¼ˆé€æ˜åº¦ã€çº¢ã€ç»¿ã€è“ï¼‰
```

#### å†…å­˜è®¡ç®—
```java
å†…å­˜å ç”¨ = å®½åº¦ Ã— é«˜åº¦ Ã— 4å­—èŠ‚ï¼ˆARGB_8888ï¼‰

ä¾‹å¦‚ï¼š
- 1080x1920çš„å›¾ç‰‡ = 1080 Ã— 1920 Ã— 4 = 8,294,400å­—èŠ‚ â‰ˆ 8MB
- 4Kå›¾ç‰‡(3840x2160) = 3840 Ã— 2160 Ã— 4 = 33,177,600å­—èŠ‚ â‰ˆ 32MB
```

**é‡è¦æç¤º**ï¼šå¤„ç†å¤§å›¾ç‰‡éœ€è¦æ³¨æ„å†…å­˜ç®¡ç†ï¼

### 2.2 åƒç´ æ“ä½œåŸç†

#### ARGBé¢œè‰²æ¨¡å‹
```
æ¯ä¸ªåƒç´ æ˜¯ä¸€ä¸ª32ä½æ•´æ•°ï¼š
AAAAAAAA RRRRRRRR GGGGGGGG BBBBBBBB
â”‚        â”‚        â”‚        â”‚
â”‚        â”‚        â”‚        â””â”€ Blue (0-255)
â”‚        â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Green (0-255)
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Red (0-255)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Alpha/é€æ˜åº¦ (0-255)

æå–é¢œè‰²åˆ†é‡ï¼š
int pixel = bitmap.getPixel(x, y);
int alpha = (pixel >> 24) & 0xFF;  // å³ç§»24ä½ï¼Œå–æœ€é«˜8ä½
int red   = (pixel >> 16) & 0xFF;  // å³ç§»16ä½ï¼Œå–8ä½
int green = (pixel >> 8)  & 0xFF;  // å³ç§»8ä½ï¼Œå–8ä½
int blue  = pixel & 0xFF;          // å–æœ€ä½8ä½
```

#### åˆæˆæ–°åƒç´ 
```java
int newPixel = (alpha << 24) | (red << 16) | (green << 8) | blue;
bitmap.setPixel(x, y, newPixel);
```

---

## 3. è£åˆ‡åŠŸèƒ½å®ç°

### 3.1 è£åˆ‡åŸç†

è£åˆ‡å°±æ˜¯ä»åŸå›¾ä¸­æå–ä¸€ä¸ªçŸ©å½¢åŒºåŸŸã€‚

```
åŸå›¾ (800x600)                  è£åˆ‡å (400x300)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                â”‚             â”‚          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚             â”‚          â”‚
â”‚   â”‚ è£åˆ‡åŒºåŸŸ â”‚ â”‚  ========>  â”‚          â”‚
â”‚   â”‚          â”‚ â”‚             â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å®ç°æ–¹æ³•

#### æ–¹æ³•1ï¼šä½¿ç”¨Bitmap.createBitmap()ï¼ˆæ¨èï¼‰

```java
/**
 * è£åˆ‡å›¾ç‰‡
 * @param source åŸå§‹å›¾ç‰‡
 * @param x èµ·å§‹Xåæ ‡
 * @param y èµ·å§‹Yåæ ‡
 * @param width è£åˆ‡å®½åº¦
 * @param height è£åˆ‡é«˜åº¦
 * @return è£åˆ‡åçš„å›¾ç‰‡
 */
public Bitmap cropImage(Bitmap source, int x, int y, int width, int height) {
    // æ£€æŸ¥å‚æ•°åˆæ³•æ€§
    if (x < 0) x = 0;
    if (y < 0) y = 0;
    if (x + width > source.getWidth()) {
        width = source.getWidth() - x;
    }
    if (y + height > source.getHeight()) {
        height = source.getHeight() - y;
    }
    
    // è£åˆ‡ï¼ˆä¸ä¼šä¿®æ”¹åŸå›¾ï¼‰
    return Bitmap.createBitmap(source, x, y, width, height);
}

// ä½¿ç”¨ç¤ºä¾‹
Bitmap cropped = cropImage(currentBitmap, 100, 100, 400, 300);
imageView.setImageBitmap(cropped);
```

**ä¸ºä»€ä¹ˆæ¨èè¿™ä¸ªæ–¹æ³•ï¼Ÿ**
- âœ… ç®€å•ã€å¿«é€Ÿ
- âœ… ç³»ç»Ÿä¼˜åŒ–
- âœ… ä¸ä¿®æ”¹åŸå›¾

#### æ–¹æ³•2ï¼šä½¿ç”¨Canvasç»˜åˆ¶

```java
public Bitmap cropImageWithCanvas(Bitmap source, Rect srcRect) {
    // åˆ›å»ºç›®æ ‡Bitmap
    Bitmap cropped = Bitmap.createBitmap(
        srcRect.width(), 
        srcRect.height(), 
        Bitmap.Config.ARGB_8888
    );
    
    // åˆ›å»ºCanvas
    Canvas canvas = new Canvas(cropped);
    
    // å®šä¹‰ç›®æ ‡çŸ©å½¢ï¼ˆä»0,0å¼€å§‹ï¼‰
    Rect dstRect = new Rect(0, 0, srcRect.width(), srcRect.height());
    
    // ç»˜åˆ¶
    canvas.drawBitmap(source, srcRect, dstRect, null);
    
    return cropped;
}

// ä½¿ç”¨ç¤ºä¾‹
Rect cropRect = new Rect(100, 100, 500, 400);  // left, top, right, bottom
Bitmap cropped = cropImageWithCanvas(currentBitmap, cropRect);
```

### 3.3 äº¤äº’å¼è£åˆ‡UI

#### éœ€è¦å®ç°çš„ç»„ä»¶

1. **CropOverlayView** - è£åˆ‡é®ç½©å±‚
```java
public class CropOverlayView extends View {
    private RectF cropRect;  // è£åˆ‡çŸ©å½¢
    private Paint cropPaint;  // ç»˜åˆ¶ç”»ç¬”
    private Paint dimPaint;   // åŠé€æ˜èƒŒæ™¯
    
    // å››ä¸ªè§’çš„è§¦æ‘¸æ£€æµ‹
    private static final int CORNER_NONE = 0;
    private static final int CORNER_TOP_LEFT = 1;
    private static final int CORNER_TOP_RIGHT = 2;
    private static final int CORNER_BOTTOM_LEFT = 3;
    private static final int CORNER_BOTTOM_RIGHT = 4;
    
    @Override
    protected void onDraw(Canvas canvas) {
        super.onDraw(canvas);
        
        // 1. ç»˜åˆ¶åŠé€æ˜èƒŒæ™¯ï¼ˆè£åˆ‡åŒºåŸŸå¤–ï¼‰
        canvas.drawColor(0x99000000);  // 60%é€æ˜é»‘è‰²
        
        // 2. ç»˜åˆ¶è£åˆ‡åŒºåŸŸï¼ˆæ¸…é™¤é€æ˜èƒŒæ™¯ï¼‰
        canvas.drawRect(cropRect, clearPaint);
        
        // 3. ç»˜åˆ¶è£åˆ‡æ¡†
        canvas.drawRect(cropRect, cropPaint);
        
        // 4. ç»˜åˆ¶ä¹å®«æ ¼çº¿
        drawGrid(canvas);
        
        // 5. ç»˜åˆ¶å››ä¸ªè§’çš„æ§åˆ¶ç‚¹
        drawCorners(canvas);
    }
    
    @Override
    public boolean onTouchEvent(MotionEvent event) {
        switch (event.getAction()) {
            case MotionEvent.ACTION_DOWN:
                // æ£€æµ‹è§¦æ‘¸çš„æ˜¯å“ªä¸ªè§’
                detectCorner(event.getX(), event.getY());
                break;
                
            case MotionEvent.ACTION_MOVE:
                // æ‹–åŠ¨è°ƒæ•´è£åˆ‡åŒºåŸŸ
                adjustCropRect(event.getX(), event.getY());
                invalidate();  // é‡ç»˜
                break;
                
            case MotionEvent.ACTION_UP:
                // å®Œæˆè°ƒæ•´
                break;
        }
        return true;
    }
}
```

#### åœ¨EditActivityä¸­ä½¿ç”¨

```java
public class EditActivity extends AppCompatActivity {
    private ImageView imageView;
    private CropOverlayView cropOverlay;
    private boolean isCropMode = false;
    
    private void enterCropMode() {
        isCropMode = true;
        
        // æ˜¾ç¤ºè£åˆ‡é®ç½©
        cropOverlay.setVisibility(View.VISIBLE);
        
        // åˆå§‹åŒ–è£åˆ‡åŒºåŸŸï¼ˆé»˜è®¤80%çš„å›¾ç‰‡åŒºåŸŸï¼‰
        int imgWidth = imageView.getWidth();
        int imgHeight = imageView.getHeight();
        int margin = (int)(imgWidth * 0.1);
        
        RectF initialRect = new RectF(
            margin, 
            margin, 
            imgWidth - margin, 
            imgHeight - margin
        );
        cropOverlay.setCropRect(initialRect);
        
        // æ›´æ”¹åº•éƒ¨å·¥å…·æ ï¼šæ˜¾ç¤º"å–æ¶ˆ"å’Œ"å®Œæˆ"æŒ‰é’®
        showCropControls();
    }
    
    private void applyCrop() {
        // è·å–è£åˆ‡çŸ©å½¢
        RectF cropRect = cropOverlay.getCropRect();
        
        // å°†å±å¹•åæ ‡è½¬æ¢ä¸ºå›¾ç‰‡åæ ‡
        RectF imageCropRect = convertToImageCoordinates(cropRect);
        
        // æ‰§è¡Œè£åˆ‡
        Bitmap cropped = Bitmap.createBitmap(
            currentBitmap,
            (int)imageCropRect.left,
            (int)imageCropRect.top,
            (int)imageCropRect.width(),
            (int)imageCropRect.height()
        );
        
        // æ›´æ–°æ˜¾ç¤º
        currentBitmap = cropped;
        imageView.setImageBitmap(cropped);
        
        // é€€å‡ºè£åˆ‡æ¨¡å¼
        exitCropMode();
    }
}
```

### 3.4 åæ ‡è½¬æ¢

**å…³é”®é—®é¢˜**ï¼šImageViewçš„å°ºå¯¸ â‰  Bitmapçš„å°ºå¯¸ï¼

```java
/**
 * å°†å±å¹•åæ ‡è½¬æ¢ä¸ºå›¾ç‰‡åæ ‡
 * åŸå› ï¼šImageViewå¯èƒ½ç¼©æ”¾äº†å›¾ç‰‡
 */
private RectF convertToImageCoordinates(RectF screenRect) {
    // è·å–ImageViewçš„æ˜¾ç¤ºçŸ©é˜µ
    Matrix matrix = imageView.getImageMatrix();
    
    // è·å–Bitmapå°ºå¯¸
    int bitmapWidth = currentBitmap.getWidth();
    int bitmapHeight = currentBitmap.getHeight();
    
    // è·å–ImageViewå°ºå¯¸
    int viewWidth = imageView.getWidth();
    int viewHeight = imageView.getHeight();
    
    // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
    float scaleX = (float)bitmapWidth / viewWidth;
    float scaleY = (float)bitmapHeight / viewHeight;
    
    // è½¬æ¢åæ ‡
    return new RectF(
        screenRect.left * scaleX,
        screenRect.top * scaleY,
        screenRect.right * scaleX,
        screenRect.bottom * scaleY
    );
}
```

---

## 4. äº®åº¦è°ƒæ•´å®ç°

### 4.1 äº®åº¦åŸç†

**äº®åº¦**ï¼šå›¾ç‰‡çš„æ˜æš—ç¨‹åº¦

è°ƒæ•´æ–¹æ³•ï¼šå¯¹æ¯ä¸ªåƒç´ çš„RGBå€¼åŠ ä¸Šæˆ–å‡å»ä¸€ä¸ªå€¼

```
åŸå§‹åƒç´ : R=100, G=150, B=200
äº®åº¦+50:  R=150, G=200, B=250
äº®åº¦-50:  R=50,  G=100, B=150

æ³¨æ„ï¼šéœ€è¦é™åˆ¶åœ¨0-255èŒƒå›´å†…
```

### 4.2 å®ç°ä»£ç 

#### æ–¹æ³•1ï¼šé€åƒç´ å¤„ç†ï¼ˆç²¾ç¡®ä½†è¾ƒæ…¢ï¼‰

```java
/**
 * è°ƒæ•´äº®åº¦
 * @param source åŸå§‹å›¾ç‰‡
 * @param brightness äº®åº¦å€¼ (-255 åˆ° +255)
 * @return è°ƒæ•´åçš„å›¾ç‰‡
 */
public Bitmap adjustBrightness(Bitmap source, int brightness) {
    // åˆ›å»ºæ–°çš„Bitmap
    Bitmap result = source.copy(source.getConfig(), true);
    
    int width = result.getWidth();
    int height = result.getHeight();
    
    // éå†æ‰€æœ‰åƒç´ 
    for (int x = 0; x < width; x++) {
        for (int y = 0; y < height; y++) {
            // è·å–åŸå§‹åƒç´ 
            int pixel = result.getPixel(x, y);
            
            // æå–ARGBåˆ†é‡
            int alpha = (pixel >> 24) & 0xFF;
            int red   = (pixel >> 16) & 0xFF;
            int green = (pixel >> 8)  & 0xFF;
            int blue  = pixel & 0xFF;
            
            // è°ƒæ•´äº®åº¦ï¼ˆé™åˆ¶èŒƒå›´0-255ï¼‰
            red   = clamp(red + brightness);
            green = clamp(green + brightness);
            blue  = clamp(blue + brightness);
            
            // åˆæˆæ–°åƒç´ 
            int newPixel = (alpha << 24) | (red << 16) | (green << 8) | blue;
            result.setPixel(x, y, newPixel);
        }
    }
    
    return result;
}

/**
 * å°†å€¼é™åˆ¶åœ¨0-255èŒƒå›´å†…
 */
private int clamp(int value) {
    if (value < 0) return 0;
    if (value > 255) return 255;
    return value;
}

// ä½¿ç”¨ç¤ºä¾‹
Bitmap brightened = adjustBrightness(currentBitmap, 50);  // å¢åŠ 50äº®åº¦
```

#### æ–¹æ³•2ï¼šä½¿ç”¨ColorMatrixï¼ˆæ¨èï¼Œæ›´å¿«ï¼‰

```java
/**
 * ä½¿ç”¨ColorMatrixè°ƒæ•´äº®åº¦
 * ä¼˜ç‚¹ï¼šGPUåŠ é€Ÿï¼Œé€Ÿåº¦å¿«
 */
public Bitmap adjustBrightnessWithColorMatrix(Bitmap source, int brightness) {
    // åˆ›å»ºColorMatrix
    ColorMatrix colorMatrix = new ColorMatrix();
    
    // è®¾ç½®äº®åº¦çŸ©é˜µ
    colorMatrix.set(new float[] {
        1, 0, 0, 0, brightness,  // Red
        0, 1, 0, 0, brightness,  // Green
        0, 0, 1, 0, brightness,  // Blue
        0, 0, 0, 1, 0            // Alpha
    });
    
    // åˆ›å»ºPaintå¹¶åº”ç”¨ColorMatrix
    Paint paint = new Paint();
    paint.setColorFilter(new ColorMatrixColorFilter(colorMatrix));
    
    // åˆ›å»ºæ–°Bitmapå¹¶ç»˜åˆ¶
    Bitmap result = Bitmap.createBitmap(
        source.getWidth(), 
        source.getHeight(), 
        source.getConfig()
    );
    Canvas canvas = new Canvas(result);
    canvas.drawBitmap(source, 0, 0, paint);
    
    return result;
}

// ä½¿ç”¨ç¤ºä¾‹
Bitmap brightened = adjustBrightnessWithColorMatrix(currentBitmap, 30);
```

#### æ–¹æ³•3ï¼šå®æ—¶é¢„è§ˆï¼ˆä¸åˆ›å»ºæ–°Bitmapï¼‰

```java
/**
 * ImageViewå®æ—¶é¢„è§ˆæ•ˆæœ
 * ä¼˜ç‚¹ï¼šä¸æ¶ˆè€—é¢å¤–å†…å­˜ï¼Œåªæ”¹å˜æ˜¾ç¤ºæ•ˆæœ
 */
public void previewBrightness(ImageView imageView, int brightness) {
    ColorMatrix colorMatrix = new ColorMatrix();
    colorMatrix.set(new float[] {
        1, 0, 0, 0, brightness,
        0, 1, 0, 0, brightness,
        0, 0, 1, 0, brightness,
        0, 0, 0, 1, 0
    });
    
    ColorMatrixColorFilter filter = new ColorMatrixColorFilter(colorMatrix);
    imageView.setColorFilter(filter);
}

// ä½¿ç”¨ç¤ºä¾‹
// åœ¨SeekBarçš„ç›‘å¬å™¨ä¸­è°ƒç”¨
seekBarBrightness.setOnSeekBarChangeListener(new SeekBar.OnSeekBarChangeListener() {
    @Override
    public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) {
        int brightness = progress - 100;  // èŒƒå›´ï¼š-100 åˆ° +100
        previewBrightness(imageView, brightness);
        textBrightness.setText(String.format("%+d", brightness));
    }
    
    @Override
    public void onStopTrackingTouch(SeekBar seekBar) {
        // ç”¨æˆ·æ¾æ‰‹åï¼Œåº”ç”¨çœŸå®æ•ˆæœ
        int brightness = seekBar.getProgress() - 100;
        currentBitmap = adjustBrightnessWithColorMatrix(currentBitmap, brightness);
        imageView.setColorFilter(null);  // æ¸…é™¤é¢„è§ˆæ»¤é•œ
        imageView.setImageBitmap(currentBitmap);
    }
});
```

### 4.3 äº®åº¦UIè®¾è®¡

```xml
<!-- äº®åº¦è°ƒæ•´æ§ä»¶ -->
<LinearLayout
    android:id="@+id/brightness_control"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="horizontal"
    android:padding="16dp"
    android:visibility="gone">
    
    <!-- å‡å· -->
    <TextView
        android:id="@+id/btn_brightness_minus"
        android:layout_width="40dp"
        android:layout_height="40dp"
        android:text="-"
        android:gravity="center"
        android:textSize="20sp"
        android:textColor="@color/white"
        android:background="@drawable/circle_button_bg"/>
    
    <!-- æ»‘å— -->
    <SeekBar
        android:id="@+id/seekbar_brightness"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_weight="1"
        android:layout_gravity="center_vertical"
        android:layout_marginHorizontal="16dp"
        android:max="200"
        android:progress="100"/>
    
    <!-- åŠ å· -->
    <TextView
        android:id="@+id/btn_brightness_plus"
        android:layout_width="40dp"
        android:layout_height="40dp"
        android:text="+"
        android:gravity="center"
        android:textSize="20sp"
        android:textColor="@color/white"
        android:background="@drawable/circle_button_bg"/>
    
    <!-- æ•°å€¼æ˜¾ç¤º -->
    <TextView
        android:id="@+id/text_brightness_value"
        android:layout_width="60dp"
        android:layout_height="wrap_content"
        android:text="0"
        android:gravity="center"
        android:textColor="@color/white"
        android:textSize="16sp"
        android:layout_marginStart="8dp"/>
        
</LinearLayout>
```

---

## 5. å¯¹æ¯”åº¦è°ƒæ•´å®ç°

### 5.1 å¯¹æ¯”åº¦åŸç†

**å¯¹æ¯”åº¦**ï¼šå›¾ç‰‡æ˜æš—åŒºåŸŸçš„å·®å¼‚ç¨‹åº¦

è°ƒæ•´æ–¹æ³•ï¼šå°†RGBå€¼ä¹˜ä»¥ä¸€ä¸ªç³»æ•°

```
å¯¹æ¯”åº¦ = 1.0ï¼ˆåŸå§‹ï¼‰
å¯¹æ¯”åº¦ > 1.0ï¼ˆå¢å¼ºå¯¹æ¯”ï¼‰ï¼šäº®çš„æ›´äº®ï¼Œæš—çš„æ›´æš—
å¯¹æ¯”åº¦ < 1.0ï¼ˆå‡å¼±å¯¹æ¯”ï¼‰ï¼šè¶‹å‘ä¸­é—´ç°è‰²

è®¡ç®—å…¬å¼ï¼š
newValue = (oldValue - 128) Ã— contrast + 128

128æ˜¯ä¸­é—´ç°åº¦å€¼
```

### 5.2 å®ç°ä»£ç 

```java
/**
 * è°ƒæ•´å¯¹æ¯”åº¦
 * @param source åŸå§‹å›¾ç‰‡
 * @param contrast å¯¹æ¯”åº¦ (0.0 - 2.0)
 *                 1.0 = åŸå§‹
 *                 < 1.0 = å‡å¼±å¯¹æ¯”
 *                 > 1.0 = å¢å¼ºå¯¹æ¯”
 */
public Bitmap adjustContrast(Bitmap source, float contrast) {
    Bitmap result = source.copy(source.getConfig(), true);
    
    int width = result.getWidth();
    int height = result.getHeight();
    
    for (int x = 0; x < width; x++) {
        for (int y = 0; y < height; y++) {
            int pixel = result.getPixel(x, y);
            
            int alpha = (pixel >> 24) & 0xFF;
            int red   = (pixel >> 16) & 0xFF;
            int green = (pixel >> 8)  & 0xFF;
            int blue  = pixel & 0xFF;
            
            // åº”ç”¨å¯¹æ¯”åº¦å…¬å¼
            red   = clamp((int)((red - 128) * contrast + 128));
            green = clamp((int)((green - 128) * contrast + 128));
            blue  = clamp((int)((blue - 128) * contrast + 128));
            
            int newPixel = (alpha << 24) | (red << 16) | (green << 8) | blue;
            result.setPixel(x, y, newPixel);
        }
    }
    
    return result;
}
```

#### ä½¿ç”¨ColorMatrixå®ç°ï¼ˆæ›´å¿«ï¼‰

```java
/**
 * ä½¿ç”¨ColorMatrixè°ƒæ•´å¯¹æ¯”åº¦
 */
public Bitmap adjustContrastWithColorMatrix(Bitmap source, float contrast) {
    ColorMatrix colorMatrix = new ColorMatrix();
    
    float offset = (1.0f - contrast) * 128;
    
    colorMatrix.set(new float[] {
        contrast, 0, 0, 0, offset,
        0, contrast, 0, 0, offset,
        0, 0, contrast, 0, offset,
        0, 0, 0, 1, 0
    });
    
    Paint paint = new Paint();
    paint.setColorFilter(new ColorMatrixColorFilter(colorMatrix));
    
    Bitmap result = Bitmap.createBitmap(
        source.getWidth(), 
        source.getHeight(), 
        source.getConfig()
    );
    Canvas canvas = new Canvas(result);
    canvas.drawBitmap(source, 0, 0, paint);
    
    return result;
}

// ä½¿ç”¨ç¤ºä¾‹
Bitmap highContrast = adjustContrastWithColorMatrix(currentBitmap, 1.5f);  // å¢å¼º50%
Bitmap lowContrast = adjustContrastWithColorMatrix(currentBitmap, 0.7f);   // å‡å¼±30%
```

---

## 6. é¥±å’Œåº¦è°ƒæ•´å®ç°

### 6.1 é¥±å’Œåº¦åŸç†

**é¥±å’Œåº¦**ï¼šé¢œè‰²çš„é²œè‰³ç¨‹åº¦

```
é¥±å’Œåº¦ = 0ï¼šå®Œå…¨ç°è‰²ï¼ˆé»‘ç™½å›¾ç‰‡ï¼‰
é¥±å’Œåº¦ = 1ï¼šåŸå§‹é¢œè‰²
é¥±å’Œåº¦ > 1ï¼šæ›´åŠ é²œè‰³
```

### 6.2 å®ç°ä»£ç 

```java
/**
 * è°ƒæ•´é¥±å’Œåº¦
 * @param source åŸå§‹å›¾ç‰‡
 * @param saturation é¥±å’Œåº¦ (0.0 - 2.0)
 *                   0 = é»‘ç™½
 *                   1 = åŸå§‹
 *                   2 = è¶…é¥±å’Œ
 */
public Bitmap adjustSaturation(Bitmap source, float saturation) {
    ColorMatrix colorMatrix = new ColorMatrix();
    colorMatrix.setSaturation(saturation);  // Androidæä¾›çš„ä¾¿æ·æ–¹æ³•
    
    Paint paint = new Paint();
    paint.setColorFilter(new ColorMatrixColorFilter(colorMatrix));
    
    Bitmap result = Bitmap.createBitmap(
        source.getWidth(), 
        source.getHeight(), 
        source.getConfig()
    );
    Canvas canvas = new Canvas(result);
    canvas.drawBitmap(source, 0, 0, paint);
    
    return result;
}

// ä½¿ç”¨ç¤ºä¾‹
Bitmap bw = adjustSaturation(currentBitmap, 0);      // é»‘ç™½
Bitmap vivid = adjustSaturation(currentBitmap, 1.5f); // é²œè‰³
```

---

## 7. UIè®¾è®¡æ–¹æ¡ˆ

### 7.1 ç¼–è¾‘æ¨¡å¼åˆ‡æ¢

```
åº•éƒ¨å·¥å…·æ è®¾è®¡ï¼š

é»˜è®¤æ¨¡å¼ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [è£åˆ‡] [è°ƒæ•´] [æ»¤é•œ] [ç¾åŒ–] [æ–‡å­—] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‚¹å‡»"è°ƒæ•´"åï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  äº®åº¦  [---------â—-------]  +20    â”‚
â”‚  å¯¹æ¯”  [----------â—------]  +15    â”‚
â”‚  é¥±å’Œ  [-----------â—-----]  +10    â”‚
â”‚                                    â”‚
â”‚  [é‡ç½®]          [å®Œæˆ]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 å¸ƒå±€XMLç¤ºä¾‹

```xml
<!-- activity_edit.xml åº•éƒ¨æ·»åŠ  -->

<!-- ç¼–è¾‘å·¥å…·é¢æ¿å®¹å™¨ -->
<FrameLayout
    android:id="@+id/edit_panel_container"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_above="@id/bottom_toolbar"
    android:background="@color/dark_background"
    android:visibility="gone">
    
    <!-- è°ƒæ•´é¢æ¿ -->
    <LinearLayout
        android:id="@+id/adjust_panel"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:padding="16dp">
        
        <!-- äº®åº¦ -->
        <include layout="@layout/adjust_slider_brightness"/>
        
        <!-- å¯¹æ¯”åº¦ -->
        <include layout="@layout/adjust_slider_contrast"/>
        
        <!-- é¥±å’Œåº¦ -->
        <include layout="@layout/adjust_slider_saturation"/>
        
        <!-- æ§åˆ¶æŒ‰é’® -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:layout_marginTop="16dp">
            
            <Button
                android:id="@+id/btn_reset"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:text="é‡ç½®"
                android:layout_marginEnd="8dp"/>
            
            <Button
                android:id="@+id/btn_apply"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:text="å®Œæˆ"
                android:backgroundTint="@color/yellow"
                android:textColor="@color/black"
                android:layout_marginStart="8dp"/>
        </LinearLayout>
        
    </LinearLayout>
    
    <!-- è£åˆ‡é¢æ¿ï¼ˆåç»­æ·»åŠ ï¼‰ -->
    
    <!-- æ»¤é•œé¢æ¿ï¼ˆåç»­æ·»åŠ ï¼‰ -->
    
</FrameLayout>
```

### 7.3 å¯å¤ç”¨çš„æ»‘å—ç»„ä»¶

```xml
<!-- adjust_slider_brightness.xml -->
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical"
    android:layout_marginBottom="12dp">
    
    <!-- æ ‡é¢˜å’Œæ•°å€¼ -->
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="horizontal">
        
        <TextView
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:text="äº®åº¦"
            android:textColor="@color/white"
            android:textSize="14sp"/>
        
        <TextView
            android:id="@+id/text_brightness_value"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="0"
            android:textColor="@color/yellow"
            android:textSize="14sp"
            android:minWidth="40dp"
            android:gravity="end"/>
    </LinearLayout>
    
    <!-- æ»‘å— -->
    <SeekBar
        android:id="@+id/seekbar_brightness"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:max="200"
        android:progress="100"
        android:layout_marginTop="8dp"/>
        
</LinearLayout>
```

---

## 8. å®Œæ•´å®ç°æ­¥éª¤

### 8.1 ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºImageProcessorå·¥å…·ç±»

```java
/**
 * å›¾ç‰‡å¤„ç†å·¥å…·ç±»
 * é›†ä¸­ç®¡ç†æ‰€æœ‰å›¾ç‰‡ç¼–è¾‘ç®—æ³•
 */
public class ImageProcessor {
    
    /**
     * è£åˆ‡å›¾ç‰‡
     */
    public static Bitmap crop(Bitmap source, int x, int y, int width, int height) {
        // å‚æ•°éªŒè¯
        x = Math.max(0, x);
        y = Math.max(0, y);
        width = Math.min(width, source.getWidth() - x);
        height = Math.min(height, source.getHeight() - y);
        
        return Bitmap.createBitmap(source, x, y, width, height);
    }
    
    /**
     * è°ƒæ•´äº®åº¦
     */
    public static Bitmap adjustBrightness(Bitmap source, int brightness) {
        ColorMatrix cm = new ColorMatrix();
        cm.set(new float[] {
            1, 0, 0, 0, brightness,
            0, 1, 0, 0, brightness,
            0, 0, 1, 0, brightness,
            0, 0, 0, 1, 0
        });
        return applyColorMatrix(source, cm);
    }
    
    /**
     * è°ƒæ•´å¯¹æ¯”åº¦
     */
    public static Bitmap adjustContrast(Bitmap source, float contrast) {
        float offset = (1.0f - contrast) * 128;
        ColorMatrix cm = new ColorMatrix();
        cm.set(new float[] {
            contrast, 0, 0, 0, offset,
            0, contrast, 0, 0, offset,
            0, 0, contrast, 0, offset,
            0, 0, 0, 1, 0
        });
        return applyColorMatrix(source, cm);
    }
    
    /**
     * è°ƒæ•´é¥±å’Œåº¦
     */
    public static Bitmap adjustSaturation(Bitmap source, float saturation) {
        ColorMatrix cm = new ColorMatrix();
        cm.setSaturation(saturation);
        return applyColorMatrix(source, cm);
    }
    
    /**
     * ç»„åˆè°ƒæ•´ï¼ˆäº®åº¦+å¯¹æ¯”åº¦+é¥±å’Œåº¦ï¼‰
     * ä¼˜åŒ–ï¼šä¸€æ¬¡å¤„ç†ï¼Œé¿å…å¤šæ¬¡åˆ›å»ºBitmap
     */
    public static Bitmap adjustAll(Bitmap source, int brightness, 
                                    float contrast, float saturation) {
        ColorMatrix cmBrightness = new ColorMatrix();
        cmBrightness.set(new float[] {
            1, 0, 0, 0, brightness,
            0, 1, 0, 0, brightness,
            0, 0, 1, 0, brightness,
            0, 0, 0, 1, 0
        });
        
        float offset = (1.0f - contrast) * 128;
        ColorMatrix cmContrast = new ColorMatrix();
        cmContrast.set(new float[] {
            contrast, 0, 0, 0, offset,
            0, contrast, 0, 0, offset,
            0, 0, contrast, 0, offset,
            0, 0, 0, 1, 0
        });
        
        ColorMatrix cmSaturation = new ColorMatrix();
        cmSaturation.setSaturation(saturation);
        
        // ç»„åˆæ‰€æœ‰çŸ©é˜µ
        ColorMatrix combined = new ColorMatrix();
        combined.postConcat(cmBrightness);
        combined.postConcat(cmContrast);
        combined.postConcat(cmSaturation);
        
        return applyColorMatrix(source, combined);
    }
    
    /**
     * åº”ç”¨ColorMatrix
     */
    private static Bitmap applyColorMatrix(Bitmap source, ColorMatrix cm) {
        Paint paint = new Paint();
        paint.setColorFilter(new ColorMatrixColorFilter(cm));
        
        Bitmap result = Bitmap.createBitmap(
            source.getWidth(), 
            source.getHeight(), 
            source.getConfig()
        );
        Canvas canvas = new Canvas(result);
        canvas.drawBitmap(source, 0, 0, paint);
        
        return result;
    }
    
    /**
     * 90åº¦æ—‹è½¬
     */
    public static Bitmap rotate90(Bitmap source) {
        Matrix matrix = new Matrix();
        matrix.postRotate(90);
        return Bitmap.createBitmap(source, 0, 0, 
            source.getWidth(), source.getHeight(), matrix, true);
    }
    
    /**
     * æ°´å¹³ç¿»è½¬
     */
    public static Bitmap flipHorizontal(Bitmap source) {
        Matrix matrix = new Matrix();
        matrix.postScale(-1, 1, source.getWidth() / 2f, source.getHeight() / 2f);
        return Bitmap.createBitmap(source, 0, 0, 
            source.getWidth(), source.getHeight(), matrix, true);
    }
    
    /**
     * å‚ç›´ç¿»è½¬
     */
    public static Bitmap flipVertical(Bitmap source) {
        Matrix matrix = new Matrix();
        matrix.postScale(1, -1, source.getWidth() / 2f, source.getHeight() / 2f);
        return Bitmap.createBitmap(source, 0, 0, 
            source.getWidth(), source.getHeight(), matrix, true);
    }
}
```

### 8.2 ç¬¬äºŒæ­¥ï¼šåœ¨EditActivityä¸­é›†æˆ

```java
public class EditActivity extends AppCompatActivity {
    
    // å›¾ç‰‡çŠ¶æ€
    private Bitmap originalBitmap;   // åŸå§‹å›¾ç‰‡
    private Bitmap currentBitmap;    // å½“å‰ç¼–è¾‘çš„å›¾ç‰‡
    private Bitmap previewBitmap;    // é¢„è§ˆç”¨çš„ä¸´æ—¶å›¾ç‰‡
    
    // è°ƒæ•´å‚æ•°ï¼ˆå½“å‰å€¼ï¼‰
    private int currentBrightness = 0;     // -100 to +100
    private float currentContrast = 1.0f;  // 0.5 to 2.0
    private float currentSaturation = 1.0f; // 0.0 to 2.0
    
    // UIç»„ä»¶
    private ImageView imageView;
    private ViewGroup adjustPanel;
    private SeekBar seekBarBrightness;
    private SeekBar seekBarContrast;
    private SeekBar seekBarSaturation;
    private TextView textBrightnessValue;
    private TextView textContrastValue;
    private TextView textSaturationValue;
    
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_edit);
        
        initViews();
        loadImage();
        setupAdjustPanel();
    }
    
    private void initViews() {
        imageView = findViewById(R.id.image_view);
        adjustPanel = findViewById(R.id.adjust_panel);
        
        seekBarBrightness = findViewById(R.id.seekbar_brightness);
        seekBarContrast = findViewById(R.id.seekbar_contrast);
        seekBarSaturation = findViewById(R.id.seekbar_saturation);
        
        textBrightnessValue = findViewById(R.id.text_brightness_value);
        textContrastValue = findViewById(R.id.text_contrast_value);
        textSaturationValue = findViewById(R.id.text_saturation_value);
    }
    
    private void setupAdjustPanel() {
        // äº®åº¦æ»‘å—ï¼ˆ-100 åˆ° +100ï¼‰
        seekBarBrightness.setMax(200);
        seekBarBrightness.setProgress(100);  // ä¸­é—´å€¼ = 0
        seekBarBrightness.setOnSeekBarChangeListener(new SeekBar.OnSeekBarChangeListener() {
            @Override
            public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) {
                currentBrightness = progress - 100;
                textBrightnessValue.setText(String.format("%+d", currentBrightness));
                previewAdjustments();
            }
            
            @Override
            public void onStartTrackingTouch(SeekBar seekBar) {}
            
            @Override
            public void onStopTrackingTouch(SeekBar seekBar) {}
        });
        
        // å¯¹æ¯”åº¦æ»‘å—ï¼ˆ0.5 åˆ° 2.0ï¼‰
        seekBarContrast.setMax(150);
        seekBarContrast.setProgress(100);  // ä¸­é—´å€¼ = 1.0
        seekBarContrast.setOnSeekBarChangeListener(new SeekBar.OnSeekBarChangeListener() {
            @Override
            public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) {
                currentContrast = progress / 100.0f;  // è½¬æ¢ä¸º 0.0 - 1.5
                if (currentContrast < 0.5f) currentContrast = 0.5f;
                textContrastValue.setText(String.format("%.2f", currentContrast));
                previewAdjustments();
            }
            
            @Override
            public void onStartTrackingTouch(SeekBar seekBar) {}
            
            @Override
            public void onStopTrackingTouch(SeekBar seekBar) {}
        });
        
        // é¥±å’Œåº¦æ»‘å—ï¼ˆ0.0 åˆ° 2.0ï¼‰
        seekBarSaturation.setMax(200);
        seekBarSaturation.setProgress(100);  // ä¸­é—´å€¼ = 1.0
        seekBarSaturation.setOnSeekBarChangeListener(new SeekBar.OnSeekBarChangeListener() {
            @Override
            public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) {
                currentSaturation = progress / 100.0f;
                textSaturationValue.setText(String.format("%.2f", currentSaturation));
                previewAdjustments();
            }
            
            @Override
            public void onStartTrackingTouch(SeekBar seekBar) {}
            
            @Override
            public void onStopTrackingTouch(SeekBar seekBar) {}
        });
        
        // é‡ç½®æŒ‰é’®
        findViewById(R.id.btn_reset).setOnClickListener(v -> resetAdjustments());
        
        // å®ŒæˆæŒ‰é’®
        findViewById(R.id.btn_apply).setOnClickListener(v -> applyAdjustments());
    }
    
    /**
     * å®æ—¶é¢„è§ˆè°ƒæ•´æ•ˆæœ
     * ä½¿ç”¨ColorFilterï¼Œä¸åˆ›å»ºæ–°Bitmapï¼ŒèŠ‚çœå†…å­˜
     */
    private void previewAdjustments() {
        // ç»„åˆColorMatrix
        ColorMatrix cmBrightness = new ColorMatrix();
        cmBrightness.set(new float[] {
            1, 0, 0, 0, currentBrightness,
            0, 1, 0, 0, currentBrightness,
            0, 0, 1, 0, currentBrightness,
            0, 0, 0, 1, 0
        });
        
        float offset = (1.0f - currentContrast) * 128;
        ColorMatrix cmContrast = new ColorMatrix();
        cmContrast.set(new float[] {
            currentContrast, 0, 0, 0, offset,
            0, currentContrast, 0, 0, offset,
            0, 0, currentContrast, 0, offset,
            0, 0, 0, 1, 0
        });
        
        ColorMatrix cmSaturation = new ColorMatrix();
        cmSaturation.setSaturation(currentSaturation);
        
        // ç»„åˆçŸ©é˜µ
        ColorMatrix combined = new ColorMatrix();
        combined.postConcat(cmBrightness);
        combined.postConcat(cmContrast);
        combined.postConcat(cmSaturation);
        
        // åº”ç”¨åˆ°ImageViewï¼ˆåªæ”¹å˜æ˜¾ç¤ºï¼Œä¸æ”¹å˜Bitmapï¼‰
        imageView.setColorFilter(new ColorMatrixColorFilter(combined));
    }
    
    /**
     * é‡ç½®æ‰€æœ‰è°ƒæ•´
     */
    private void resetAdjustments() {
        currentBrightness = 0;
        currentContrast = 1.0f;
        currentSaturation = 1.0f;
        
        seekBarBrightness.setProgress(100);
        seekBarContrast.setProgress(100);
        seekBarSaturation.setProgress(100);
        
        imageView.setColorFilter(null);
    }
    
    /**
     * åº”ç”¨è°ƒæ•´åˆ°å®é™…Bitmap
     */
    private void applyAdjustments() {
        // æ˜¾ç¤ºè¿›åº¦æç¤º
        Toast.makeText(this, "æ­£åœ¨å¤„ç†...", Toast.LENGTH_SHORT).show();
        
        // åœ¨åå°çº¿ç¨‹å¤„ç†
        new Thread(() -> {
            // åº”ç”¨æ‰€æœ‰è°ƒæ•´
            Bitmap adjusted = ImageProcessor.adjustAll(
                currentBitmap,
                currentBrightness,
                currentContrast,
                currentSaturation
            );
            
            // å›åˆ°ä¸»çº¿ç¨‹æ›´æ–°UI
            runOnUiThread(() -> {
                // é‡Šæ”¾æ—§Bitmap
                if (currentBitmap != originalBitmap) {
                    currentBitmap.recycle();
                }
                
                // æ›´æ–°å½“å‰Bitmap
                currentBitmap = adjusted;
                
                // æ¸…é™¤ColorFilterå¹¶æ˜¾ç¤ºæ–°Bitmap
                imageView.setColorFilter(null);
                imageView.setImageBitmap(currentBitmap);
                
                // é‡ç½®å‚æ•°
                resetAdjustments();
                
                // éšè—è°ƒæ•´é¢æ¿
                adjustPanel.setVisibility(View.GONE);
                
                Toast.makeText(this, "è°ƒæ•´å·²åº”ç”¨", Toast.LENGTH_SHORT).show();
            });
        }).start();
    }
    
    /**
     * æ˜¾ç¤ºè°ƒæ•´é¢æ¿
     */
    private void showAdjustPanel() {
        adjustPanel.setVisibility(View.VISIBLE);
    }
}
```

### 8.3 ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ åº•éƒ¨å·¥å…·æ åˆ‡æ¢

```java
// åœ¨EditActivityä¸­æ·»åŠ åº•éƒ¨æŒ‰é’®ç‚¹å‡»äº‹ä»¶

private void setupBottomToolbar() {
    // è£åˆ‡æŒ‰é’®
    findViewById(R.id.btn_tool_crop).setOnClickListener(v -> {
        // æ˜¾ç¤ºè£åˆ‡é¢æ¿ï¼ˆä¸‹ä¸€æ­¥å®ç°ï¼‰
        Toast.makeText(this, "è£åˆ‡åŠŸèƒ½", Toast.LENGTH_SHORT).show();
    });
    
    // è°ƒæ•´æŒ‰é’®
    findViewById(R.id.btn_tool_adjust).setOnClickListener(v -> {
        showAdjustPanel();
    });
    
    // æ»¤é•œæŒ‰é’®
    findViewById(R.id.btn_tool_filter).setOnClickListener(v -> {
        Toast.makeText(this, "æ»¤é•œåŠŸèƒ½", Toast.LENGTH_SHORT).show();
    });
    
    // æ—‹è½¬æŒ‰é’®
    findViewById(R.id.btn_tool_rotate).setOnClickListener(v -> {
        rotateImage();
    });
}

/**
 * æ—‹è½¬å›¾ç‰‡
 */
private void rotateImage() {
    new Thread(() -> {
        Bitmap rotated = ImageProcessor.rotate90(currentBitmap);
        runOnUiThread(() -> {
            if (currentBitmap != originalBitmap) {
                currentBitmap.recycle();
            }
            currentBitmap = rotated;
            imageView.setImageBitmap(currentBitmap);
        });
    }).start();
}
```

---

## 9. æ€§èƒ½ä¼˜åŒ–

### 9.1 å†…å­˜ä¼˜åŒ–

#### é—®é¢˜ï¼šå¤„ç†å¤§å›¾ç‰‡å®¹æ˜“OOM

```java
/**
 * æŒ‰éœ€ç¼©æ”¾åŠ è½½å›¾ç‰‡
 * åŸå› ï¼šé¿å…åŠ è½½è¿‡å¤§çš„å›¾ç‰‡å¯¼è‡´å†…å­˜æº¢å‡º
 */
public static Bitmap decodeSampledBitmap(Uri uri, Context context, 
                                         int reqWidth, int reqHeight) {
    try {
        // ç¬¬ä¸€æ­¥ï¼šåªè§£æå°ºå¯¸ï¼Œä¸åŠ è½½åƒç´ æ•°æ®
        BitmapFactory.Options options = new BitmapFactory.Options();
        options.inJustDecodeBounds = true;
        
        InputStream is = context.getContentResolver().openInputStream(uri);
        BitmapFactory.decodeStream(is, null, options);
        is.close();
        
        // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
        int sampleSize = calculateInSampleSize(options, reqWidth, reqHeight);
        
        // ç¬¬äºŒæ­¥ï¼šæŒ‰ç¼©æ”¾æ¯”ä¾‹åŠ è½½
        options.inJustDecodeBounds = false;
        options.inSampleSize = sampleSize;
        options.inPreferredConfig = Bitmap.Config.ARGB_8888;
        
        is = context.getContentResolver().openInputStream(uri);
        Bitmap bitmap = BitmapFactory.decodeStream(is, null, options);
        is.close();
        
        return bitmap;
        
    } catch (IOException e) {
        e.printStackTrace();
        return null;
    }
}

/**
 * è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
 */
private static int calculateInSampleSize(BitmapFactory.Options options,
                                         int reqWidth, int reqHeight) {
    int width = options.outWidth;
    int height = options.outHeight;
    int inSampleSize = 1;
    
    if (width > reqWidth || height > reqHeight) {
        int halfWidth = width / 2;
        int halfHeight = height / 2;
        
        while ((halfWidth / inSampleSize) >= reqWidth &&
               (halfHeight / inSampleSize) >= reqHeight) {
            inSampleSize *= 2;
        }
    }
    
    return inSampleSize;
}

// ä½¿ç”¨ç¤ºä¾‹
// åœ¨EditActivityä¸­åŠ è½½å›¾ç‰‡æ—¶ä½¿ç”¨
Uri imageUri = Uri.parse(imageUriString);
currentBitmap = decodeSampledBitmap(imageUri, this, 1080, 1920);
```

### 9.2 å¤„ç†é€Ÿåº¦ä¼˜åŒ–

#### ä½¿ç”¨RenderScriptåŠ é€Ÿï¼ˆå¯é€‰ï¼‰

```java
/**
 * ä½¿ç”¨RenderScriptåŠ é€Ÿå›¾ç‰‡å¤„ç†
 * åŸç†ï¼šGPUå¹¶è¡Œè®¡ç®—ï¼Œæ¯”CPUå¿«10-100å€
 */
public class ImageProcessorRS {
    private RenderScript rs;
    
    public ImageProcessorRS(Context context) {
        rs = RenderScript.create(context);
    }
    
    /**
     * å¿«é€Ÿæ¨¡ç³Šï¼ˆç¤ºä¾‹ï¼‰
     */
    public Bitmap blur(Bitmap input, float radius) {
        Allocation inputAlloc = Allocation.createFromBitmap(rs, input);
        Allocation outputAlloc = Allocation.createTyped(rs, inputAlloc.getType());
        
        ScriptIntrinsicBlur blurScript = ScriptIntrinsicBlur.create(
            rs, Element.U8_4(rs));
        blurScript.setRadius(radius);
        blurScript.setInput(inputAlloc);
        blurScript.forEach(outputAlloc);
        
        Bitmap output = Bitmap.createBitmap(
            input.getWidth(), input.getHeight(), input.getConfig());
        outputAlloc.copyTo(output);
        
        return output;
    }
    
    public void cleanup() {
        rs.destroy();
    }
}
```

### 9.3 UIå“åº”ä¼˜åŒ–

```java
/**
 * ä½¿ç”¨Handleré˜²æŠ–ï¼Œé¿å…é¢‘ç¹å¤„ç†
 */
private Handler adjustHandler = new Handler();
private Runnable adjustRunnable;

private void previewAdjustmentsDebounced() {
    // å–æ¶ˆä¹‹å‰çš„ä»»åŠ¡
    if (adjustRunnable != null) {
        adjustHandler.removeCallbacks(adjustRunnable);
    }
    
    // å»¶è¿Ÿ100msæ‰§è¡Œ
    adjustRunnable = () -> previewAdjustments();
    adjustHandler.postDelayed(adjustRunnable, 100);
}

// åœ¨SeekBarç›‘å¬å™¨ä¸­ä½¿ç”¨
@Override
public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) {
    currentBrightness = progress - 100;
    textBrightnessValue.setText(String.format("%+d", currentBrightness));
    previewAdjustmentsDebounced();  // ä½¿ç”¨é˜²æŠ–ç‰ˆæœ¬
}
```

---

## 10. æœ€ä½³å®è·µ

### 10.1 æ’¤é”€/é‡åšåŠŸèƒ½

```java
/**
 * ç¼–è¾‘å†å²ç®¡ç†
 */
public class EditHistory {
    private Stack<Bitmap> undoStack = new Stack<>();
    private Stack<Bitmap> redoStack = new Stack<>();
    private int maxSize = 10;  // æœ€å¤šä¿å­˜10æ­¥
    
    /**
     * ä¿å­˜å½“å‰çŠ¶æ€
     */
    public void pushState(Bitmap bitmap) {
        // å¤åˆ¶Bitmap
        Bitmap copy = bitmap.copy(bitmap.getConfig(), true);
        undoStack.push(copy);
        
        // é™åˆ¶æ ˆå¤§å°
        if (undoStack.size() > maxSize) {
            Bitmap oldest = undoStack.remove(0);
            oldest.recycle();
        }
        
        // æ¸…ç©ºé‡åšæ ˆ
        clearRedoStack();
    }
    
    /**
     * æ’¤é”€
     */
    public Bitmap undo(Bitmap current) {
        if (undoStack.isEmpty()) return null;
        
        // å½“å‰çŠ¶æ€å‹å…¥é‡åšæ ˆ
        Bitmap copy = current.copy(current.getConfig(), true);
        redoStack.push(copy);
        
        // ä»æ’¤é”€æ ˆå¼¹å‡º
        return undoStack.pop();
    }
    
    /**
     * é‡åš
     */
    public Bitmap redo(Bitmap current) {
        if (redoStack.isEmpty()) return null;
        
        // å½“å‰çŠ¶æ€å‹å…¥æ’¤é”€æ ˆ
        Bitmap copy = current.copy(current.getConfig(), true);
        undoStack.push(copy);
        
        // ä»é‡åšæ ˆå¼¹å‡º
        return redoStack.pop();
    }
    
    /**
     * æ¸…ç©ºæ‰€æœ‰å†å²
     */
    public void clear() {
        clearUndoStack();
        clearRedoStack();
    }
    
    private void clearUndoStack() {
        while (!undoStack.isEmpty()) {
            undoStack.pop().recycle();
        }
    }
    
    private void clearRedoStack() {
        while (!redoStack.isEmpty()) {
            redoStack.pop().recycle();
        }
    }
}

// åœ¨EditActivityä¸­ä½¿ç”¨
private EditHistory editHistory = new EditHistory();

private void applyAdjustments() {
    // ä¿å­˜å½“å‰çŠ¶æ€åˆ°å†å²
    editHistory.pushState(currentBitmap);
    
    // åº”ç”¨è°ƒæ•´...
}

private void undo() {
    Bitmap previous = editHistory.undo(currentBitmap);
    if (previous != null) {
        currentBitmap.recycle();
        currentBitmap = previous;
        imageView.setImageBitmap(currentBitmap);
    } else {
        Toast.makeText(this, "æ— æ³•æ’¤é”€", Toast.LENGTH_SHORT).show();
    }
}
```

### 10.2 ä¿å­˜è°ƒæ•´å‚æ•°

```java
/**
 * ä¿å­˜è°ƒæ•´å‚æ•°åˆ°é¡¹ç›®
 * åŸå› ï¼šç”¨æˆ·å¯ä»¥é‡æ–°æ‰“å¼€é¡¹ç›®ç»§ç»­è°ƒæ•´
 */
public class AdjustParams implements Serializable {
    public int brightness = 0;
    public float contrast = 1.0f;
    public float saturation = 1.0f;
    
    public String toJson() {
        return new Gson().toJson(this);
    }
    
    public static AdjustParams fromJson(String json) {
        return new Gson().fromJson(json, AdjustParams.class);
    }
}

// åœ¨EditProjectä¸­æ·»åŠ å­—æ®µ
private String adjustParamsJson;

// ä¿å­˜å‚æ•°
AdjustParams params = new AdjustParams();
params.brightness = currentBrightness;
params.contrast = currentContrast;
params.saturation = currentSaturation;
project.setAdjustParamsJson(params.toJson());
projectManager.updateProject(project);

// åŠ è½½å‚æ•°
if (project.getAdjustParamsJson() != null) {
    AdjustParams params = AdjustParams.fromJson(project.getAdjustParamsJson());
    currentBrightness = params.brightness;
    currentContrast = params.contrast;
    currentSaturation = params.saturation;
    updateSeekBars();
}
```

### 10.3 é”™è¯¯å¤„ç†

```java
/**
 * å®‰å…¨çš„å›¾ç‰‡å¤„ç†åŒ…è£…
 */
public class SafeImageProcessor {
    
    public static Bitmap processWithFallback(Bitmap source, 
                                             ImageProcessFunction function) {
        try {
            return function.process(source);
        } catch (OutOfMemoryError e) {
            // å†…å­˜ä¸è¶³ï¼Œé‡Šæ”¾ç¼“å­˜åé‡è¯•
            System.gc();
            try {
                return function.process(source);
            } catch (Exception e2) {
                Log.e("ImageProcessor", "å¤„ç†å¤±è´¥", e2);
                return source;  // è¿”å›åŸå›¾
            }
        } catch (Exception e) {
            Log.e("ImageProcessor", "å¤„ç†å¤±è´¥", e);
            return source;
        }
    }
    
    @FunctionalInterface
    public interface ImageProcessFunction {
        Bitmap process(Bitmap source) throws Exception;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
Bitmap result = SafeImageProcessor.processWithFallback(currentBitmap, 
    bitmap -> ImageProcessor.adjustBrightness(bitmap, 50));
```

---

## 11. æµ‹è¯•å»ºè®®

### 11.1 æµ‹è¯•ç”¨ä¾‹

| æµ‹è¯•é¡¹ | æµ‹è¯•æ­¥éª¤ | é¢„æœŸç»“æœ |
|-------|---------|---------|
| äº®åº¦è°ƒæ•´ | ç§»åŠ¨æ»‘å—åˆ°+50 | å›¾ç‰‡å˜äº® |
| å¯¹æ¯”åº¦è°ƒæ•´ | ç§»åŠ¨æ»‘å—åˆ°1.5 | å¯¹æ¯”å¢å¼º |
| é¥±å’Œåº¦è°ƒæ•´ | ç§»åŠ¨æ»‘å—åˆ°0 | å›¾ç‰‡å˜é»‘ç™½ |
| é‡ç½®åŠŸèƒ½ | ç‚¹å‡»é‡ç½®æŒ‰é’® | æ‰€æœ‰å‚æ•°å½’é›¶ |
| åº”ç”¨è°ƒæ•´ | ç‚¹å‡»å®ŒæˆæŒ‰é’® | æ•ˆæœæ°¸ä¹…åº”ç”¨ |
| æ’¤é”€åŠŸèƒ½ | åº”ç”¨åç‚¹å‡»æ’¤é”€ | æ¢å¤ä¸Šä¸€æ­¥ |
| å†…å­˜æµ‹è¯• | å¤„ç†4Kå›¾ç‰‡ | ä¸å´©æºƒ |
| æ—‹è½¬æµ‹è¯• | è¿ç»­æ—‹è½¬4æ¬¡ | æ¢å¤åŸçŠ¶ |

### 11.2 æ€§èƒ½åŸºå‡†

```
æµ‹è¯•è®¾å¤‡ï¼šæ™®é€šAndroidè®¾å¤‡
å›¾ç‰‡å¤§å°ï¼š1080x1920

æœŸæœ›æ€§èƒ½ï¼š
- é¢„è§ˆå“åº”ï¼š< 16msï¼ˆ60fpsï¼‰
- åº”ç”¨è°ƒæ•´ï¼š< 500ms
- è£åˆ‡å¤„ç†ï¼š< 200ms
- æ—‹è½¬å¤„ç†ï¼š< 300ms
```

---

## 12. æ€»ç»“

### 12.1 å®ç°æ¸…å•

- [ ] åˆ›å»ºImageProcessorå·¥å…·ç±»
- [ ] å®ç°äº®åº¦è°ƒæ•´ç®—æ³•
- [ ] å®ç°å¯¹æ¯”åº¦è°ƒæ•´ç®—æ³•
- [ ] å®ç°é¥±å’Œåº¦è°ƒæ•´ç®—æ³•
- [ ] å®ç°è£åˆ‡åŠŸèƒ½
- [ ] å®ç°æ—‹è½¬/ç¿»è½¬åŠŸèƒ½
- [ ] è®¾è®¡è°ƒæ•´é¢æ¿UI
- [ ] å®ç°å®æ—¶é¢„è§ˆ
- [ ] å®ç°æ’¤é”€/é‡åš
- [ ] æ·»åŠ å†…å­˜ä¼˜åŒ–
- [ ] æ·»åŠ æ€§èƒ½ä¼˜åŒ–
- [ ] å®Œæ•´æµ‹è¯•

### 12.2 å…³é”®çŸ¥è¯†ç‚¹

1. **Bitmapåƒç´ æ“ä½œ**ï¼šARGBé¢œè‰²æ¨¡å‹ã€åƒç´ éå†
2. **ColorMatrix**ï¼šé«˜æ•ˆçš„é¢œè‰²å˜æ¢ï¼ŒGPUåŠ é€Ÿ
3. **å†…å­˜ç®¡ç†**ï¼šBitmapå›æ”¶ã€æŒ‰éœ€åŠ è½½ã€ç¼©æ”¾
4. **UIå“åº”**ï¼šå®æ—¶é¢„è§ˆã€é˜²æŠ–ã€åå°å¤„ç†
5. **åæ ‡è½¬æ¢**ï¼šå±å¹•åæ ‡â†”å›¾ç‰‡åæ ‡

### 12.3 è¿›é˜¶æ–¹å‘

- ä½¿ç”¨RenderScript GPUåŠ é€Ÿ
- å®ç°æ›´å¤šæ»¤é•œï¼ˆæ€€æ—§ã€å†·æš–è‰²è°ƒç­‰ï¼‰
- æ·»åŠ æ›²çº¿è°ƒæ•´ï¼ˆCurvesï¼‰
- å®ç°å›¾å±‚åŠŸèƒ½
- æ·»åŠ AIå¢å¼ºï¼ˆè¶…åˆ†è¾¨ç‡ã€æ™ºèƒ½ç¾é¢œç­‰ï¼‰

---

## ğŸ“š å‚è€ƒèµ„æº

- [Androidå®˜æ–¹æ–‡æ¡£ - Bitmap](https://developer.android.com/reference/android/graphics/Bitmap)
- [Androidå®˜æ–¹æ–‡æ¡£ - ColorMatrix](https://developer.android.com/reference/android/graphics/ColorMatrix)
- [å›¾åƒå¤„ç†ç®—æ³•æ•™ç¨‹](https://en.wikipedia.org/wiki/Digital_image_processing)

---

**å‡†å¤‡å¥½å¼€å§‹å®ç°äº†å—ï¼ŸæŒ‰ç…§è¿™ä¸ªæ•™ç¨‹ä¸€æ­¥æ­¥æ¥ï¼Œä½ å°±èƒ½å®ç°å®Œæ•´çš„å›¾ç‰‡ç¼–è¾‘åŠŸèƒ½ï¼** ğŸ¨

æœ‰ä»»ä½•é—®é¢˜ï¼Œéšæ—¶å‚è€ƒè¿™ä¸ªæ–‡æ¡£ï¼Œæˆ–è€…è¯¢é—®æˆ‘ï¼

